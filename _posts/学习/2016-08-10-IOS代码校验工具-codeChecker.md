---
layout: post
category: 学习之路
---

之前分享的Git hooks 遗留下来的那个问题，怎么更好的去使用 spacecommander 去做事情，去优化我们的代码风格。

任务:

1.更完善的代码校验

2.更方便的集成，更简易的部署到项目中

3.更合理的代码提示和 代码不规范处提示。

4.代码静态扫描，服务器端运行脚本进行全局扫描校验



今天主要是完善前面三项。相当于介绍一个工具的使用和简单介绍一下使用原理。

## the CodeChecker

IOS 代码校验，一键部署，只需要执行一次命令文件就可以给IOS项目部署代码校验工具

依赖于Git hooks 每次代码 commit 的时候进行代码强制校验。

要求：Git工程、OC代码

实现:

### 1.减少用户使用时的步骤

工具部署只需要一个启动脚本，自动下载校验工具、部署脚本和钩子以及创建新的操作命令

```
1.提取项目中得setup.command文件放置到工程的根目录，双击执行 并根据提示操作command文件

2.如果执行提示无权限 > 终端 cd 到当前目录 执行 chmod +x setup.command

3.Would you like to use the codeChecker ? [ yes / no ]

4.选中 no 为卸载操作，当不需要代码校验的时候执行此操作 / 选择yes为安装操作。

5.Which style do you need ?  [ list / window ]

6.提供两种模式
```

### 2.提供两种代码提示

为方便不同的使用，现提供两种代码规范提示模式：list 模式 / window 模式

list模式每次commit会自动显示错误文档，显示代码纠正点，可以根据代码问题点自行进行代码修整 或者使用快捷命令自动修改代码格式。

![](https://xilankong.github.io/resource/list.png)

如上图部分，※号下面为原本的错误样式 —号下面部分为校验后代码样式 数字分别表示从多少行开始到多少行。



window模式开启代码对比功能，左侧为自己的代码、右侧为规范代码，提供快捷方式进行代码修正覆盖。

```
window 模式下的操作快捷方式

Ctrl - w 切换光标位置

Ctrl-w K（把当前窗口移到最上边）

Ctrl-w H（把当前窗口移到最左边）

Ctrl-w J（把当前窗口移到最下边）

Ctrl-w L（把当前窗口移到最右边）

]c 跳向下一个编辑点

[c 跳向上一个编辑点

do 将另一个文件的编辑点覆盖到当前文件（注意光标位置）

dp 将当前文件的编辑点覆盖到另一份文件

Ctrl - u 撤销修改(保证光标在需要撤销的文件下 处于INSERT模式) 如果非INSERT模式直接 u 就是撤销

:qa 不修改退出 （编辑过后不可用 需要使用 :qa! 表示撤销修改后退出）

:wqa 保存修改退出
```

### 3.代码安全备份，代码误操作还原

由于在刚开始使用终端操作的时候经常会有误操作的可能，所以为了防止影响到自己的工作代码，执行commit的时候，会默认备份到指定目录。

当想恢复刚刚执行的format操作可以使用codelog命令查看format记录，codereset命令(参数是需要还原的文件在项目中的相对地址)还原刚刚操作过的文件。(暂时只支持单文件还原，每个文件的备份数据在本地进行迭代。如果需要某个文件的多个版本前的备份记录，需要先还原备份目录到指定节点)。









