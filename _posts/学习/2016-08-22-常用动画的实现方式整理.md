---
layout: post
category: 学习之路
---

tag:

1.cornerRadius 属于layer层的参数，无法通过UIView animation来动画变更

```
    CABasicAnimation *basicAnimation = [CABasicAnimation animationWithKeyPath:@"cornerRadius"];
    basicAnimation.duration = 0.2;
    [self.animationView.layer setCornerRadius:20.0f];
    [self.animationView.layer addAnimation:basicAnimation forKey:@"cornerRadius"];
```

2.CGAffineTransformMakeRotation 使用的时候  如果直接frame变更 会导致形变 使用center的变更来变更位置就不会。

3.CAAnimation 的代理

```
CABasicAnimation *animation = [CABasicAnimation animation];
animation.keyPath = @"position.x";
animation.fromValue = @(15);
animation.toValue = @(SCREEN_WIDTH-15);
animation.duration = 1.0f;
animation.autoreverses = YES;
animation.repeatCount = HUGE_VAL;

// 保证fillMode起作用
// flyRight.removedOnCompletion = false
// 动画结束后,layer会保持结束状态
// flyRight.fillMode = kCAFillModeForwards
animation.delegate = self;
[self.imageViewOne.layer addAnimation:animation forKey:@"p_img_one"];


-(void)animationDidStart:(CAAnimation *)anim
{
    NSLog(@"start");
}
-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag
{
    NSLog(@"stop");
}
```



4.当UIView remove出父容器  UIView 会自动销毁  layer动画也是  但我们处理layer销毁的时候最好还是主动去remove掉动画



5.如何主动停止



UIView 动画  / Layer动画    通用

removeAllAnimations 或者移除某个动画  



暂停/恢复：

    if (self.imageViewOne.layer.speed == 0.0) {
      CFTimeInterval pausedTime = [self.imageViewOne.layer timeOffset];
      self.imageViewOne.layer.speed = 1.0;
      self.imageViewOne.layer.timeOffset = 0.0;
      self.imageViewOne.layer.beginTime = 0.0;
      CFTimeInterval timeSincePause = [self.imageViewOne.layer convertTime:CACurrentMediaTime() fromLayer:nil] - pausedTime;
      self.imageViewOne.layer.beginTime = timeSincePause;
    }else{
    
    CFTimeInterval pausedTime = [self.imageViewOne.layer convertTime:CACurrentMediaTime() fromLayer:nil];
    self.imageViewOne.layer.speed = 0.0;
    self.imageViewOne.layer.timeOffset = pausedTime;
    }
在一个动画过程中插入其他动画  阻塞？



6.CA动画 基本 key path 

position.x 针对的时center

#### 一些常用的animationWithKeyPath值的总结

| 值                       | 说明                  | 使用形式                                     |
| ----------------------- | ------------------- | ---------------------------------------- |
| transform.scale         | 比例转化                | @(0.8)                                   |
| transform.scale.x       | 宽的比例                | @(0.8)                                   |
| transform.scale.y       | 高的比例                | @(0.8)                                   |
| transform.rotation.x    | 围绕x轴旋转              | @(M_PI)                                  |
| transform.rotation.y    | 围绕y轴旋转              | @(M_PI)                                  |
| transform.rotation.z    | 围绕z轴旋转              | @(M_PI)                                  |
| cornerRadius            | 圆角的设置               | @(50)                                    |
| backgroundColor         | 背景颜色的变化             | (id)[UIColor purpleColor].CGColor        |
| bounds                  | 大小，中心不变             | [NSValue valueWithCGRect:CGRectMake(0, 0, 200, 200)]; |
| position                | 位置(中心点的改变)          | [NSValue valueWithCGPoint:CGPointMake(300, 300)]; |
| contents                | 内容，比如UIImageView的图片 | imageAnima.toValue = (id)[UIImage imageNamed:@"to"].CGImage; |
| opacity                 | 透明度                 | @(0.7)                                   |
| contentsRect.size.width | 横向拉伸缩放              | @(0.4)最好是0~1之间的                          |



## 1.核心动画

1.什么是核心动画

给view加上动画，本质上是对其layer进行操作，layer包含了各种支持动画的属性，动画则包含了属性变化的值、变化的速度、变化的时间等等，两者结合产生动画的过程。

　　核心动画和UIView动画的对比：UIView动画可以看成是对核心动画的封装，和UIView动画不同的是，通过核心动画改变layer的状态（比如position），动画执行完毕后实际上是没有改变的（表面上看起来已改变）。

　　总体来说核心动画的优点有：

　　1）性能强大，使用硬件加速，可以同时向多个图层添加不同的动画效果

　　2）接口易用，只需要少量的代码就可以实现复杂的动画效果。

　　3）运行在后台线程中，在动画过程中可以响应交互事件（UIView动画默认动画过程中不响应交互事件）。





2.核心动画类

CAAnimation是所有动画对象的父类，实现CAMediaTiming协议，负责控制动画的时间、速度和时间曲线等等，是一个抽象类，不能直接使用。

　　CAPropertyAnimation ：是CAAnimation的子类，它支持动画地显示图层的keyPath，一般不直接使用。

　　iOS9.0之后新增CASpringAnimation类，它实现弹簧效果的动画，是CABasicAnimation的子类。

　　综上，核心动画类中可以直接使用的类有：

　　CABasicAnimation

　　CAKeyframeAnimation

　　CATransition

　　CAAnimationGroup

　　CASpringAnimation



3.核心方法

1.初始化CAAnimation对象

一般使用animation方法生成实例

(instancetype)animation;
　　如果是CAPropertyAnimation的子类，还可以通过animationWithKeyPath生成实例

(instancetype)animationWithKeyPath:(nullable NSString *)path;
　　2.设置动画的相关属性

　　设置动画的执行时间，执行曲线，keyPath的目标值，代理等等

　　3.动画的添加和移除

　　调用CALayer的addAnimation:forKey:方法将动画添加到CALayer中，这样动画就开始执行了

(void)addAnimation:(CAAnimation *)anim forKey:(nullable NSString *)key;
　　调用CALayer的removeAnimation方法停止CALayer中的动画

     - (void)removeAnimationForKey:(NSString *)key;
     - (void)removeAllAnimations;


4.核心属性

　keyPath：可以指定keyPath为CALayer的属性值，并对它的值进行修改，以达到对应的动画效果，需要注意的是部分属性值是不支持动画效果的。

　　以下是具有动画效果的keyPath：

   //CATransform3D Key Paths : (example)transform.rotation.z
     //rotation.x
     //rotation.y
     //rotation.z
     //rotation 旋轉
     //scale.x
     //scale.y
     //scale.z
     //scale 缩放
     //translation.x
     //translation.y
     //translation.z
     //translation 平移
     //CGPoint Key Paths : (example)position.x
     //x
     //y
     //CGRect Key Paths : (example)bounds.size.width
     //origin.x
     //origin.y
     //origin
     //size.width
     //size.height
     //size
     //opacity
     //backgroundColor
     //cornerRadius 
     //borderWidth
     //contents 
     //Shadow Key Path:
     //shadowColor 
     //shadowOffset 
     //shadowOpacity 
     //shadowRadius
　　duration：动画的持续时间

　　repeatCount：动画的重复次数

　　timingFunction：动画的时间节奏控制

 timingFunctionName的enum值如下：
     kCAMediaTimingFunctionLinear 匀速
     kCAMediaTimingFunctionEaseIn 慢进
     kCAMediaTimingFunctionEaseOut 慢出
     kCAMediaTimingFunctionEaseInEaseOut 慢进慢出
     kCAMediaTimingFunctionDefault 默认值（慢进慢出）
　　fillMode：视图在非Active时的行为

　　removedOnCompletion：动画执行完毕后是否从图层上移除，默认为YES（视图会恢复到动画前的状态），可设置为NO（图层保持动画执行后的状态，前提是fillMode设置为kCAFillModeForwards）

　　beginTime：动画延迟执行时间（通过CACurrentMediaTime() + your time 设置）

　　delegate：代理

代理方法如下：
     - (void)animationDidStart:(CAAnimation *)anim;  //动画开始
     - (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag; //动画结束

代理造成的循环引用问题 由于CAAnimation的delegate使用的strong类型，

所以在全局变量如下设置时会产生循环引用的情况

self.animation.delegate = self;//可通过复用dealloc方法来验证



使用NSProxy解决，在一个对象中对self 弱引用处理  然后通过类方法把 弱引用处理过的self对象转给delegate

YYWeakProxy



1.CAAnimation 

1.图形绘制（基础属性、基础方法的使用介绍、使用场景、实例）  CALayer(和各种子类http://blog.csdn.net/iunion/article/details/26221213)  CGContextRef  UIBezierPathhttp://www.cnblogs.com/small-octopus/p/4874600.html   

2.CAAnimation 基础属性 、基础方法、方法介绍，使用 实例

3.更高级的动画



1.UIViewAnimation

1.基础方法 属性介绍 使用场景 实例

2.特效动画



3.长循动画 粒子动画类



4.控制器转场动画

http://www.cocoachina.com/ios/20150729/12775.html



5.facebook pop



6.测试



转场动画

http://www.jianshu.com/p/45434f73019e

http://www.cocoachina.com/ios/20150719/12600.html



手势处理



动力学

http://blog.csdn.net/gmfxch/article/details/46758157

动画总结

http://www.ithao123.cn/content-2377425.html

http://www.cocoachina.com/ios/20141022/10005.html



https://www.objccn.io/issue-12-1/