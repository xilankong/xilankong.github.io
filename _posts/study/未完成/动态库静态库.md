## 认识动态库和静态库

### 1、库（Library）

库是指一段编译好的二进制代码，并提供头文件供别人使用。

### 2、动态库（Dynamic library）

动态库也称动态链接，是在程序编译时不会被链接到目标代码中，直到可执行文件被执行过程中才被加载调用，即按需加载。

### 3、静态库（Static library）

静态库也称静态链接，是在链接阶段，将汇编生成的目标文件.o与引用到的库一起链接打包到可执行文件 ( XXX.app 包内的exec ) 中。

### 4、搜索路径 （Search path）

搜索路径是指程序链接时，到哪个位置寻找库。

```
@executable_path：表示可执行程序所在的目录。
@loader_path：表示每一个被加载的 binary (包括App, dylib, framework, plugin等) 所在的目录。
@rpath：是一个保存着一个或多个路径的变量，告诉连接器到哪里找库。
```

### 5、Mach-O Type 

全称 Mach Object Type ，是一种用于存储可执行文件，目标代码，动态库，内核转储的文件格式。

Xcode中查看Target 的 Build Settings 可以发现可以选择，里面就包含了动态库和静态库。

#### 6、其他 

.tbd 文件格式: 存储跨平台模块映射的文本文件，Xcode7以后 .dylib格式 动态库替换为.tbd格式。

framework是一种打包方式，将库的二进制文件，头文件和有关的资源文件打包到一起，方便管理和分发。

.a 文件

.o 文件

_CodeSignature 目录

.car 文件

Framework目录

der文件

exec文件

.bundle

## 静态库特点

1、常见以.a或.framework结尾。

2、静态库存储结构

当App依赖的第三方库采用静态库形式链接，编译器链接时，将收集编译好代码和第三方库，存储于App代码区域，即这些资源是App可执行文件的一部分。App启动时，存储于App代码区域的代码将加载到App寻址地址空间。其流程如下图

![](https://xilankong.github.io/resource/address_space1_2x.png)



## 动态库特点

1、常见以 .tbd 或 .dylib 或 .framework 结尾。（默认在.app包内的Framework文件夹中）

2、动态库最低支持版本 8.0

3、动态库存储结构

当App依赖的第三方库采用动态库形式链接，编译器链接时，将第三方库相对引用，存储于App代码区域，真实的依赖资源存储于操作系统或各个App共用路径下。App启动时，只加载需要的资源到App寻址地址空间，即按需索取。其流程如下图

![](https://xilankong.github.io/resource/address_space2_2x.png)



4、

App之间共用库，但是苹果本身是强制不允许的（进程间共享动态库是不允许的，iOS上的动态库只能是私有的，因此我们仍然不能将动态库文件放置在除了自身沙盒以外的其它任何地方。）

但iOS8之后，开放了`App Extension`功能，可以为一个应用创建插件，这样主app和插件之间共享动态库还是可行的。

5、

签名：动态库都有签名

比如我们在.app包里可以看到 _CodeSignature 会出现在很多包含非系统资源的目录级，这个其实就相当于资源签名，也是为了防止热更新等操作。

6、

OC和Swift 都是C编写的，编译后都是.o文件 ，为什么混编的时候不能用动态库，只是因为苹果不允许OC Swift混编成库而已。。。

7、

@import 和 #import的区别 

```
#import 防止重复导入，
#import 相当于直接导入对应文件，而@import相当于引入一个对应文件的地址，需要使用的时候再去引入使用
@import 引入某个框架下得某个文件可以不需要明确框架，会自动引入。
#import 编译会慢一点

import 中得 <> 和 "" 的区别  查找路径优先级不同，<> 优先查找系统层再找用户自定义层，""相反 
```

import

动态库引入其他动态库的时候要用@import



