---
layout: post
category: iOS开发基础
title : "Xcode编译知识"
---

编译过程



1、预处理 

把宏替换，删除注释，展开头文件，产生 **.i** 文件。

2、编译

把之前的 **.i** 文件转换成汇编语言，产生 **.s**文件。

3、汇编

把汇编语言文件转换为机器码文件，产生 **.o** 文件。

4、链接

对**.o**文件中的对于其他的库的引用的地方进行引用，生成最后的可执行文件（同时也包括多个 **.o** 文件进行 link）。



编译器

使用的clang 编译器的作用就是把源代码转换为更为低级的 LLVM 





执行一次 Xcode build 的流程



1、编译信息写入辅助文件，创建编译后的文件架构  name.app



2、处理文件打包信息

```
Entitlements:
{
    "application-identifier" = "app的bundleid";
    "aps-environment" = development;
}
```



3、执行cocoapod编译前脚本

```
例如对于使用CocoaPod的工程会执行CheckPods Manifest.lock



```



4、编译.m文件 使用`CompileC`和`clang`命令。

```
CompileC ClassName.o ClassName.m normal x86_64 objective-c com.apple.compilers.llvm.clang.1_0.compiler
export LANG=en_US.US-ASCII
export PATH="..."
clang -x objective-c -arch x86_64 -fmessage-length=0 -fobjc-arc... -Wno-missing-field-initializers ... -DDEBUG=1 ... -isysroot iPhoneSimulator10.1.sdk -fasm-blocks ... -I 上文提到的文件 -F 所需要的Framework  -iquote 所需要的Framework  ... -c ClassName.c -o ClassName.o
```

5、链接需要的Framework，例如Foundation.framework,AFNetworking.framework,ALiPay.fframework

6、编译xib文件

7、拷贝xib，图片等资源文件到结果目录

8、编译ImageAssets

9、处理info.plist

10、执行CocoaPod脚本

11、拷贝Swift标准库

12、创建.app文件和对其签名





dsym文件

我们在每次编译过后，都会生成一个dsym文件。dsym文件中，存储了16进制的函数地址映射。

在App实际执行的二进制文件中，是通过地址来调用方法的。在App crash的时候，第三方工具（Fabric,友盟等）会帮我们抓到崩溃的调用栈，调用栈里会包含crash地址的调用信息。然后，通过dSYM文件，我们就可以由地址映射到具体的函数位置。