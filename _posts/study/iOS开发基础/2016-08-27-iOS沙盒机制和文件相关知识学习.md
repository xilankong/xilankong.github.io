---
layout: post
category: iOS开发进阶
title : "iOS沙盒机制和文件相关知识学习"
---

> 出于安全考虑，iOS系统的沙盒机制规定每个应用都只能访问当前沙盒目录下面的文件（也有例外，比如在用户授权情况下访问通讯录，相册等），这个规则展示了iOS系统的封闭性。
>
> 在应用开发中，如果要保存沙盒中某个文件路径，注意不要保存全路径，只能保存在沙盒中的相对路径，否则会导致路径访问错误。这是因为每次重新编译安装应用时，沙盒目录路径会改变。以下是对每个文件夹的作用进行说明：

### 一、沙盒目录结构

![](https://xilankong.github.io/resource/ios_app_file.png)

```
AppName.app :  应用程序包目录，包含应用程序和所需资源。由于应用程序必须经过签名，所以您在运行时不能对这个目录中的内容进行修改，否则可能会使应用程序无法启动。

Documents：您应该将所有的应用程序数据文件写入到这个目录下。这个目录用于存储用户数据。该路径可通过配置实现iTunes共享文件。会被iTunes同步。

Documents/Inbox：用来存放由外部应用请求当前应用程序打开的文件，会被iTunes同步。

Library：下面有两个目录，该路径下的文件夹，除Caches以外，都会被iTunes备份。

Preferences：包含应用程序的偏好设置文件。您不应该直接创建偏好设置文件，而是应该使用NSUserDefaults类来取得和设置应用程序的偏好。结果在目录下面以plist的方式存储

Caches：用于存放应用程序专用的支持文件，保存应用程序再次启动过程中需要的信息。可创建子文件夹。可以用来放置您希望被备份但不希望被用户看到的数据。

tmp：用来存放应用再次启动时不需要的临时文件，该目录下的东西随时可能被系统清理掉，不会被iTunes同步。

```

### 二、获取沙盒各个路径的方法

沙盒主目录

```
// 获取沙盒主目录路径
NSString *homeDir = NSHomeDirectory();
```

Documents目录

```
// 获取Documents目录路径
NSString *docDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];

// 存放文件
NSString *path = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES).firstObject;
    
NSString *fileName = [path stringByAppendingPathComponent:@"myfile"];

NSString *content = @"测试数据";

NSData *contentData = [content dataUsingEncoding:NSUTF8StringEncoding];

BOOL result = [contentData writeToFile:fileName atomically:YES];

//文件存放在Documents目录
```

Library目录

```

// 获取Library的目录路径
NSString *libDir = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES) lastObject];

// 获取Caches目录路径
NSString *cachesDir = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) firstObject];

// 缓存文件存放和Documents目录存放文件一样

//Preferences 通过 NSUserDefault存数据
```

tmp目录

```
// 获取tmp目录路径
NSString *tmpDir =  NSTemporaryDirectory();


// 缓存文件存放和Documents目录存放文件一样
```

AppBundle目录路径

```
// 获取AppBundle目录路径
NSLog(@"%@",[[NSBundle mainBundle] bundlePath]);

NSString *imagePath = [[NSBundle mainBundle] pathForResource:@"apple" ofType:@"png"];

UIImage *appleImage = [[UIImage alloc] initWithContentsOfFile:imagePath];
```



