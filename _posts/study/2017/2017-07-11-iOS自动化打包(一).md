---
layout: post
category: 2017年
title : "iOS自动化打包(一)"
---

> iOS自动化打包，主要分为两步来实现
>
> 1、测试同学手动或自动打包
>
> 2、测试同学手机上通过web下载安装包进行测试



1、第一步

打包这一块已经较为成熟，以前常用的就是Jenkins的打包，但是需要自己处理证书等打包中常遇到的问题

xcode更新之后有了自动证书管理的能力，（具体到底有没有自动更新）

本文要介绍的是 Jenkins + fastlane：

fastlane是iOS中常用的自动打包工具、包括打包、上传等功能，简单好用

[fastlane使用说明书](https://xilankong.github.io/2017年/2017/07/05/fastlane使用说明书.html)

当我们自己打包的时候，只需要终端就可以打包，为了方便其他端的打包和定时打包功能，所以继续使用Jenkins作为打包客户端。

[Jenkins 使用说明书](https://xilankong.github.io/2017年/2017/07/09/jenkins使用说明书.html)



2、第二步

在之前、测试同学打完包后需要链接到指定服务器去拉取ipa手动安装，一个是不方便，一个是不灵活，老板想看个最新测试包，你说：哎那啥等会我帮你连个电脑装一个？itms-services:

所以，选择通过实现一个简单的web来拉取最新的ipa，自动安装（需要认证devices的问题）

要求：safari  items-services协议

http://blog.csdn.net/qian_meng/article/details/48767209?ref=myread



先做一个简单的了解

1、在本地开一个tomcat，然后找一个工程，我这里选了ROOT默认工程，放入一个用开发证书（或者ad-hoc）打包的ipa。

2、配置一份plist,最主要的是ipa的url地址，这个地址是你通过tomcat能访问到ipa的地址。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>items</key>
	<array>
		<dict>
			<key>assets</key>
			<array>
				<dict>
					<key>kind</key>
					<string>software-package</string>
					<key>url</key>
					<string>http://10.3.20.31:8080/personal.ipa</string>
				</dict>
			</array>
			<key>metadata</key>
			<dict>
				<key>bundle-identifier</key>
				<string>com.xxx.xxx</string>
				<key>bundle-version</key>
				<string>6</string>
				<key>kind</key>
				<string>software</string>
				<key>title</key>
				<string>个人简历</string>
			</dict>
		</dict>
	</array>
</dict>
</plist>
```

3、把这份plist挂到一个https地址上，保证可以通过https访问（我这边挂在了https://gitee.com，其他代码管理地址都可以，然后使用它的原始数据地址）

```
因为apple要求使用https，所以必须是https
```



4、拼接一份itms-services

```
itms-services://?action=download-manifest&url=https://gitee.com/具体地址/test.plist
```

5、因为这个证书是受信任的，所以通过手机safari访问这个地址就可以安装我们之前保存在tomat下面的ipa



UDID的获取和注册之路

https://github.com/shaojiankui/iOS-UDID-Safari