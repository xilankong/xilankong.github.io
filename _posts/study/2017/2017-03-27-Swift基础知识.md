---
layout: post
category: 2017å¹´
title : "SwiftåŸºç¡€çŸ¥è¯†"
---

## SwiftåŸºç¡€çŸ¥è¯†ç»†èŠ‚ç‚¹å›é¡¾

å­¦ä¹ Swiftè¿‡ç¨‹ä¸­æ•´ç†çš„ä¸€äº›å®¹æ˜“å‡ºé”™çš„ç‚¹ã€‚



## 1ã€åŸºç¡€çŸ¥è¯†Tips

#### let å±æ€§å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™å†èµ‹å€¼ï¼Œå› ä¸ºåˆå§‹åŒ–åªä¼šæ‰§è¡Œä¸€æ¬¡

```
let data: String
init() {
    data = ""
    super.init(nibName: nil, bundle: nil)
}
```

#### ç±»åˆ«åˆ«åçš„ä½¿ç”¨

```
typealias AudioSample = UInt16
```

#### do catchï¼ŒErroræ•è·

```
do {
    try canThrowAnError()
    // æ²¡æœ‰é”™è¯¯æ¶ˆæ¯æŠ›å‡º
} catch {
    // æœ‰ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯æŠ›å‡º
}
```

#### æ£€æŸ¥ API å¯ç”¨æ€§

```

if #available(iOS 10, macOS 10.12, *) {
    // åœ¨ iOS ä½¿ç”¨ iOS 10 çš„ API, åœ¨ macOS ä½¿ç”¨ macOS 10.12 çš„ API
} else {
    // ä½¿ç”¨å…ˆå‰ç‰ˆæœ¬çš„ iOS å’Œ macOS çš„ API
}
```

#### optional

**ä»€ä¹ˆæ˜¯optional**

Swiftä¸­çš„Optionalä½œä¸ºä¸€ç§ç±»å‹ï¼Œæ—¢å¯ä»¥å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥ä¸ºç©ºï¼ˆä¹Ÿå°±æ˜¯Swifté‡Œçš„nilï¼‰,é€šå¸¸åœ¨ç±»å‹åé¢åŠ ä¸€ä¸ªï¼Ÿè¡¨ç¤ºå®ƒæ˜¯Optionalç±»å‹çš„ï¼š

```
var number: Int? = 32
```

å…¶å® ? åªä¸è¿‡æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼ŒOptionalçš„å®é™…ç±»å‹æ˜¯ä¸€ä¸ªenum:

```
public enum Optional<Wrapped> : ExpressibleByNilLiteral {

    case none
    /// The presence of a value, stored as `Wrapped`.
    case some(Wrapped)
    /// Creates an instance that stores the given value.
    public init(_ some: Wrapped)
```

ä¸Šé¢çš„ var number: Int? = 32 ä¹Ÿå°±å¯ä»¥è¡¨ç¤ºä¸ºï¼š

```
var numbet: Optional<Int> = 32
```

**Optionalçš„ä½¿ç”¨**

Swifté€šè¿‡å¼•å…¥Optionalè§£å†³äº†Objective-Cä¸­â€œæœ‰â€ä¸â€œæ— â€çš„é—®é¢˜ï¼Œä½¿ä»£ç çš„å®‰å…¨æ€§å¾—åˆ°äº†å¾ˆå¤§çš„æé«˜ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿåº”è¯¥çŸ¥é“ï¼ŒSwiftæ˜¯ä¸€ç§ç±»å‹å®‰å…¨çš„è¯­è¨€ã€‚



optionalå‡½æ•°é“¾ï¼š

```
swift delegate ä»£ç†è°ƒç”¨ ä¸å†ä½¿ç”¨resonseå“åº”å»æ ¡éªŒæ–¹æ³•æ˜¯å¦å­˜åœ¨

ç›´æ¥optionalå»è°ƒç”¨å°±å¯ä»¥  

self.delegate?.GXQActionSheetClickAtIndex(index: type!, viewController: self)
```



ä¸€ä¸ªOptionalå¯¹è±¡åªå­˜åœ¨ä¸¤ç§çŠ¶æ€ï¼šåŒ…å«ä¸€ä¸ªå€¼ï¼Œæˆ–è€…ä¸ºç©ºï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡è§£åŒ…ï¼ˆunwrapï¼‰æ¥è·å–ã€‚

å‡ºäºç±»å‹å®‰å…¨çš„è€ƒè™‘ï¼Œæˆ‘ä»¬ä¸èƒ½å†æŠŠOptionalå½“ä½œBooleanå€¼å¤„ç†ã€‚åƒä¸‹é¢è¿™æ¡è¯­å¥åœ¨swiftä¸­ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯

```
var myString: String? = "Hello"
if myString {
    print(myString)
}
ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡==å’Œ!=ï¼Œå°†Optionalå€¼å’Œnilåšæ¯”è¾ƒæ¥åˆ¤æ–­å®ƒæ˜¯å¦åŒ…å«ä¸€ä¸ªå€¼ã€‚å¦‚æœä¸åŒ…å«ä»»ä½•å€¼ï¼Œåˆ™ä¸ºç©ºã€‚

if myString != nil{
    print("myString contain a string value of \(myString!)")
}
```

åœ¨ä¸Šé¢çš„è¯­å¥é‡Œï¼Œå½“æˆ‘ä»¬ç¡®å®šmyStringåŒ…å«ä¸€ä¸ªå€¼æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨myStringåé¢æ·»åŠ ä¸€ä¸ª!æ¥è¿›è¡Œå¼ºåˆ¶è§£åŒ…(forced unwrapping)ï¼Œè·å–Optionalå†…åŒ…å«çš„å€¼ã€‚

**Optionalçš„è§£åŒ…**

```
è§£åŒ…åˆ†ä¸ºæ˜¾å¼è§£åŒ…ã€éšå¼è§£åŒ…

éšå¼è§£åŒ…ï¼š
å°±æ˜¯åœ¨å®šä¹‰å¯é€‰ç±»å‹å€¼çš„æ—¶å€™ï¼ŒåŠ ä¸Š ï¼è¿›è¡Œå¼ºåˆ¶è§£åŒ…ï¼Œéšå¼è§£åŒ…çš„å†™æ³•ä¼šå¸¦æ¥ä¸€ä¸ªæ½œåœ¨çš„å±é™©ï¼Œå¦‚æœå°è¯•è®¿é—®ä¸€ä¸ªä¸ºç©ºçš„éšå¼è§£åŒ…Optional, å°±ä¼šé‡åˆ°ä¸€ä¸ªruntime errorã€‚

æ˜¾å¼è§£åŒ…ï¼š

if-letè§£åŒ…

if let x = someOptional{
  print("someOptional value is \(x)")
}

case let è§£åŒ… 

if case .some(let x) = someOptional{
    print("someOptional value is \(x)") //å¦‚æœä¸ºnil æƒ…å†µ å¯ä¸ä¼šè¾“å‡ºä¸œè¥¿ å› ä¸ºåŒ¹é…çš„æ˜¯Some!
}
if case let x? = someOptional{
    print("someOptional value is \(x)") //å¦‚æœä¸ºnil æƒ…å†µ å¯ä¸ä¼šè¾“å‡ºä¸œè¥¿ å› ä¸ºåŒ¹é…çš„æ˜¯Some!
}

ç”¨å¤„ï¼š
æ¯”å¦‚å…ƒç¥–æšä¸¾è§£åŒ…ã€ switchä¸­å¾—è§£åŒ…
var roles = [
    GameRole.Player(name: "ç©å®¶ä¸€"),
    GameRole.Player(name: "ç©å®¶äºŒ"),
    GameRole.NPC(name: "NPC1", faction: "å…‰æ˜"),
    GameRole.NPC(name: "NPC2", faction: "é»‘æš—"),
    GameRole.Monster(name: "æ€ªç‰©1", element: 1),
    GameRole.Monster(name: "æ€ªç‰©2", element: 2),
]

// æ—©å‰ä½¿ç”¨æ–¹æ³•
// éå†æ•´ä¸ªè§’è‰²
for role in roles{
    // å› ä¸ºæ˜¯æšä¸¾ æ‰€ä»¥è¦switchæ¥åŒ¹é…
    switch role{
    case let .NPC(name,faction):
        print("æœ‰ \(name)-\(faction)å‡ºæ²¡")
    default:
        break
    }
}

ç®€åŒ–ä¸Šé¢çš„ä»£ç 
for case let .NPC(name,faction) in roles {
    print("æœ‰ \(name)-\(faction)å‡ºæ²¡")
}
è¿˜å¯ä»¥ç»§ç»­åŠ æ¡ä»¶
for case let .NPC(name,faction) in roles where faction == "é»‘æš—"{
    print("æœ‰ \(name)-\(faction)å‡ºæ²¡")
}
```



#### Swiftæ ¹æ®ç±»åå­—åˆ›å»ºå®ä¾‹

ä»»ä½•è‡ªå®šä¹‰çš„å¯¹è±¡éƒ½æ˜¯AnyClassçš„å­ç±»

```
(Demo.classForCoder() as! Demo.Type).init()
é€šè¿‡å¦‚ä¸Šæ–¹å¼å»æ„å»ºå®ä¾‹çš„æ—¶å€™æŠ¥é”™ï¼š

Constructing an object of class type â€˜**â€™ with a metatype value must use a â€˜requiredâ€™ initializer.

éœ€è¦è¦†å†™Demoä¸­çš„

override required init() {
    super.init()
}

```



#### Swiftå‘½åè§„åˆ™

```
å¯¹ç±»ã€ç»“æ„ä½“ã€æšä¸¾å’Œåè®®ç­‰ç±»å‹å‘½åï¼Œåº”è¯¥é‡‡ç”¨å¤§é©¼å³°æ³•ï¼Œå¦‚SplitViewControllerã€‚

æ–‡ä»¶åï¼Œé‡‡ç”¨å¤§é©¼å³°æ³•ï¼Œå¦‚BlockOperation.swiftã€‚

æ‰©å±•æ–‡ä»¶ï¼Œæœ‰çš„æ—¶å€™æ‰©å±•æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­çš„ï¼Œå®ƒçš„å‘½åæ˜¯â€œåŸå§‹ç±»å‹å+æ‰©å±•åâ€ä½œä¸ºæ‰©å±•æ–‡ä»¶åï¼Œå¦‚NSOperation+Operations.swiftã€‚

å˜é‡å’Œå±æ€§ï¼Œé‡‡ç”¨åº”è¯¥é‡‡ç”¨å°é©¼å³°æ³•ï¼Œå¦‚studentNumberã€‚

å¸¸é‡ï¼Œé‡‡ç”¨å¤§é©¼å³°æ³•ï¼Œå¦‚MaxStudentNumberã€‚

æšä¸¾æˆå‘˜ï¼Œä¸å¸¸é‡ç±»ä¼¼ï¼Œé‡‡ç”¨å¤§é©¼å³°æ³•ï¼Œå¦‚ExecutionFailedã€‚
æšä¸¾caseæˆå‘˜ é‡‡ç”¨å°é©¼å³°æ³•ã€‚

å‡½æ•°å’Œæ–¹æ³•ï¼Œé‡‡ç”¨åº”è¯¥é‡‡ç”¨å°é©¼å³°æ³•ï¼Œå¦‚balanceAccountã€isButtonPressedç­‰ã€‚
```

#### Swiftå·¥ç¨‹å…¥å£

```
swift å·¥ç¨‹ä¸­å¾—mainæ–¹æ³•å…¥å£

@UIApplicationMain
```

#### Swiftè®¿é—®ä¿®é¥°ç¬¦

```
Swift 3.0 çš„ openï¼Œpublicï¼Œinternalï¼Œfileprivateï¼Œprivate å…³é”®å­— 
fileprivateå’Œ open
fileprivate ç±»ä¼¼ä¹‹å‰çš„private ï¼Œæ–‡ä»¶å†…ç§æœ‰ï¼Œå•ä¸ªæ–‡ä»¶å†…å¯ä»¥äº’ç›¸è®¿é—®ï¼Œ
ç°åœ¨çš„private å°±æ˜¯çœŸæ­£æ„ä¹‰çš„ç§æœ‰ï¼Œå³ä½¿åŒæ–‡ä»¶å†… åªè¦è·¨ç±»äº† å°±ä¸èƒ½è®¿é—®

open ç›¸å½“äº å¯ä»¥å¤–éƒ¨ç»§æ‰¿ publicç°åœ¨ä¸èƒ½å¤–éƒ¨ç»§æ‰¿

import Foundation
 
/// finalçš„å«ä¹‰ä¿æŒä¸å˜
public final class FinalClass { }
 
// è¿™ä¸ªç±»åœ¨ModuleAçš„èŒƒå›´å¤–æ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ï¼Œåªèƒ½è¢«è®¿é—®
public class PublicClass {
 
    public func testPublic() {}
 
    // è¿™æ˜¯é”™è¯¯çš„å†™æ³•ï¼Œå› ä¸ºclasså·²ç»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œ
    // æ‰€ä»¥ä»–çš„æ–¹æ³•çš„è®¿é—®æƒé™ä¸èƒ½å¤§äºç±»çš„è®¿é—®æƒé™
    open func testOpen() {}
 
    // finalçš„å«ä¹‰ä¿æŒä¸å˜
    public final func testPublicFinal() {}
}
 
// åœ¨ModuleAçš„èŒƒå›´å¤–å¯ä»¥è¢«ç»§æ‰¿
open class OpenClass {
    // è¿™ä¸ªå±æ€§åœ¨ModuleAçš„èŒƒå›´å¤–ä¸èƒ½è¢«override
    public var size : Int = 0
 
    // è¿™ä¸ªæ–¹æ³•åœ¨ModuleAçš„èŒƒå›´å¤–ä¸èƒ½è¢«override
    public func testPublic() {}
 
    // è¿™ä¸ªæ–¹æ³•åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è¢«override
    open func testOpen() {}
 
    ///finalçš„å«ä¹‰ä¿æŒä¸å˜
    public final func testPublicFinal() {}
}

import Foundation
import ModuleA
 
// è¿™ä¸ªå†™æ³•æ˜¯é”™è¯¯çš„ï¼Œç¼–è¯‘ä¼šå¤±è´¥,ç±»è®¿é—®æƒé™æ ‡è®°çš„æ˜¯publicï¼Œåªèƒ½è¢«è®¿é—®ä¸èƒ½è¢«ç»§æ‰¿
class SubA : PublicClass { }
 
// è¿™æ ·å†™æ³•å¯ä»¥é€šè¿‡,Classè®¿é—®æƒé™ä¸º `open`.
class SubB : OpenClass {
 
    // è¿™æ ·å†™ä¹Ÿä¼šç¼–è¯‘å¤±è´¥,å› ä¸ºè¿™ä¸ªæ–¹æ³•æƒé™ä¸ºpublicï¼Œä¸æ˜¯`open'.
    override func testPublic() { }
 
    // è¿™ä¸ªæ–¹æ³•å› ä¸ºåœ¨SubclassableParentClassä¸­æ ‡è®°ä¸ºopenï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å†™
    // è¿™é‡Œä¸éœ€è¦å†å£°æ˜ä¸ºopenï¼Œå› ä¸ºè¿™ä¸ªç±»æ˜¯internalçš„
    override func testOpen() { }
}
 
open class SubC : OpenClass {
    // è¿™ç§å†™æ³•ä¼šç¼–è¯‘å¤±è´¥
    override func testPublicFinal() { }
 
    // æ­£ç¡®çš„å†™æ³•ï¼Œæ–¹æ³•ä¹Ÿéœ€è¦æ ‡è®°ä¸ºopen
    open override func testOpen() { }
}
 
open class SubE : OpenClass {
    // ä¹Ÿå¯ä»¥æ˜¾å¼çš„æŒ‡å‡ºè¿™ä¸ªæ–¹æ³•ä¸èƒ½å†è¢«override
    public final override func testOpen() { }
}

ç»„åˆè®¿é—®æ§åˆ¶ç¬¦
open internal(set) var str: String?
```

#### Swiftè‡ªå®šä¹‰ä¸‹æ ‡

```
extension Int {
    subscript(index: Int) -> Int {
        return self
    }
}

print(3333[0])
subscript //åœ¨Extentionä¸­å†™ä¸‹æ ‡æ–¹æ³•
```

#### SwiftåŸºç¡€æ•°æ®ç»“æ„

```
Int UIntçš„åŒºåˆ« å¸¦Uè¡¨ç¤ºæ— ç¬¦å·æ•´æ•°ï¼Œä¸å¸¦Uè¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° è‡³äºåé¢çš„ä½æ•°é€‰æ‹©ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®å½“å‰è¿è¡Œç¯å¢ƒè‡ªåŠ¨é€‰æ‹©

swiftä¸­ é™¤äº†åè¿›åˆ¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ (0x) å…«è¿›åˆ¶ (0o) äºŒè¿›åˆ¶ (0b)
ä»¥åŠå¯ä»¥ä½¿ç”¨åƒä½åˆ†éš”ç¬¦  let million = 1_000_000

Double(fifteen_10) //è¿™é‡Œå®é™…æ˜¯é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ªDoubleç±»å‹çš„å€¼ï¼Œå¹¶éç±»å‹è½¬æ¢

type(of:PI) æŸ¥çœ‹ç±»å‹

PI = 15 + 314e-2  æ­£å¸¸ç¼–è¯‘

let PI_fifteen = PI + fifteen_10    é”™è¯¯

ä¿ç•™ä¸¤ä½ç²¾åº¦
round(combinationFee  * 100)/100

```

staticå’Œclassçš„ä½¿ç”¨

```
Swiftä¸­è¡¨ç¤º â€œç±»å‹èŒƒå›´ä½œç”¨åŸŸâ€ è¿™ä¸€æ¦‚å¿µæœ‰ä¸¤ä¸ªä¸åŒçš„å…³é”®å­—ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯staticå’Œclassã€‚è¿™ä¸¤ä¸ªå…³é”®å­—ç¡®å®éƒ½è¡¨è¾¾äº†è¿™ä¸ªæ„æ€ï¼Œä½†æ˜¯åœ¨å…¶ä»–ä¸€äº›è¯­è¨€ï¼ŒåŒ…æ‹¬Objective-Cä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç‰¹åˆ«åœ°åŒºåˆ†ç±»å˜é‡/ç±»æ–¹æ³•å’Œé™æ€å˜é‡/é™æ€å‡½æ•°ã€‚ä½†æ˜¯åœ¨Swiftä¸­ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—å´æ˜¯ä¸èƒ½ç”¨æ··çš„ã€‚

åœ¨éclassçš„ç±»å‹ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨staticæ¥æè¿°ç±»å‹ä½œç”¨åŸŸã€‚è¿™åŒ…æ‹¬åœ¨enumå’Œstructä¸­è¡¨è¿°ç±»å‹æ–¹æ³•å’Œç±»å‹å±æ€§æ—¶ã€‚åœ¨è¿™ä¸¤ä¸ªå€¼ç±»å‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç±»å‹èŒƒå›´å†…å£°æ˜å¹¶ä½¿ç”¨å­˜å‚¨å±æ€§ï¼Œè®¡ç®—å±æ€§å’Œæ–¹æ³•ã€‚staticé€‚ç”¨çš„åœºæ™¯æœ‰è¿™äº›ï¼š

    struct Point {  
         let x: Double  
         let y: Double  
         // å­˜å‚¨å±æ€§  
         static let zero = Point(x: 0, y: 0)  
         // è®¡ç®—å±æ€§  
         static var ones: [Point] {  
             return [Point(x: 1, y: 1),  
                     Point(x: -1, y: 1),  
                     Point(x: 1, y: -1),  
                     Point(x: -1, y: -1)]  
         }  
         // ç±»å‹æ–¹æ³•  
         static func add(p1: Point, p2: Point) -> Point {  
             return Point(x: p1.x + p2.x, y: p1.y + p2.y)  
         }  
     }  
    enumçš„æƒ…å†µä¸è¿™ä¸ªååˆ†ç±»ä¼¼ï¼Œå°±ä¸å†åˆ—ä¸¾äº†ã€‚





classå…³é”®å­—ç›¸æ¯”èµ·æ¥å°±æ˜ç™½è®¸å¤šï¼Œæ˜¯ä¸“é—¨ç”¨åœ¨classç±»å‹çš„ä¸Šä¸‹æ–‡ä¸­çš„ï¼Œå¯ä»¥ç”¨æ¥ä¿®é¥°ç±»æ–¹æ³•ä»¥åŠç±»çš„è®¡ç®—å±æ€§ã€‚è¦ç‰¹åˆ«æ³¨æ„classä¸­ç°åœ¨æ˜¯ä¸èƒ½å‡ºç°å­˜å‚¨å±æ€§çš„ï¼Œæˆ‘ä»¬å¦‚æœå†™ç±»ä¼¼è¿™æ ·çš„ä»£ç çš„è¯ï¼š

    class MyClass {  
        class var bar: Bar?  
    }  



ç¼–è¯‘æ—¶ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š

class variables not yet supported

è¿™ä¸»è¦æ˜¯å› ä¸ºåœ¨Objective-Cä¸­å°±æ²¡æœ‰ç±»å˜é‡è¿™ä¸ªæ¦‚å¿µï¼Œä¸ºäº†è¿è¡Œæ—¶çš„ç»Ÿä¸€å’Œå…¼å®¹ï¼Œæš‚æ—¶ä¸å¤ªæ–¹ä¾¿æ·»åŠ è¿™ä¸ªç‰¹æ€§ã€‚Appleè¡¨ç¤ºä»Šåå°†ä¼šè€ƒè™‘åœ¨æŸä¸ªå‡çº§ç‰ˆæœ¬ä¸­å®è£…classç±»å‹çš„ç±»å­˜å‚¨å˜é‡ï¼Œç°åœ¨çš„è¯ï¼Œæˆ‘ä»¬åªèƒ½åœ¨classä¸­ç”¨classå…³é”®å­—å£°æ˜æ–¹æ³•å’Œè®¡ç®—å±æ€§ã€‚

æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯protocolã€‚åœ¨Swiftä¸­classã€structå’Œenuméƒ½æ˜¯å¯ä»¥å®ç°protocolçš„ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³åœ¨protocolé‡Œå®šä¹‰ä¸€ä¸ªç±»å‹åŸŸä¸Šçš„æ–¹æ³•æˆ–è€…è®¡ç®—å±æ€§çš„è¯ï¼Œåº”è¯¥ç”¨å“ªä¸ªå…³é”®å­—å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨classè¿›è¡Œå®šä¹‰ï¼Œä½†æ˜¯åœ¨å®ç°æ—¶è¿˜æ˜¯æŒ‰ç…§ä¸Šé¢çš„è§„åˆ™ï¼šåœ¨classé‡Œä½¿ç”¨classå…³é”®å­—ï¼Œè€Œåœ¨structæˆ–enumä¸­ä»ç„¶ä½¿ç”¨staticâ€”â€”è™½ç„¶åœ¨protocolä¸­å®šä¹‰æ—¶ä½¿ç”¨çš„æ˜¯classï¼š

     protocol MyProtocol {  
         class func foo() -> String  
     }  
     struct MyStruct: MyProtocol {  
         static func foo() -> String {  
             return "MyStruct"  
         }  
     }  
     enum MyEnum: MyProtocol {  
         static func foo() -> String {  
             return "MyEnum"  
         }  
     }  
     class MyClass: MyProtocol {  
         class func foo() -> String {  
             return "MyClass"  
         }  
     }  
    
    protocol extension åšé»˜è®¤å®ç°
    
    protocol ImageFactory {
        func createImage(color: UIColor) -> UIImage?
    }
    
    extension ImageFactory {
        func createImage(color: UIColor) -> UIImage? {
            let rect = CGRect(x: 0.0, y: 0.0, width: 1.0, height: 1.0)
            UIGraphicsBeginImageContext(rect.size)
            let context = UIGraphicsGetCurrentContext()
            context?.setFillColor(color.cgColor)
            context?.fill(rect)
            let image = UIGraphicsGetImageFromCurrentImageContext()
            UIGraphicsEndImageContext()
            return image ?? nil
        }
    }



```





## 2ã€è¿ç®—ç¬¦

#### åŸºç¡€è¿ç®—ç¬¦

```
1â€¦3 é—­åŒºé—´ åŒ…æ‹¬ 1ã€2ã€3

1..<3 å¼€åŒºé—´ åŒ…æ‹¬ 1ã€2

2... ã€ ...2 å•ä¾§åŒºé—´

== ç›¸ç­‰
!= ä¸ç­‰

Swiftçš„ == å¯ä»¥è¦†ç›–é‡å†™ï¼Œè‡ªå®šä¹‰åˆ¤ç­‰æ¡ä»¶

=== å†…å­˜åœ°å€æ¯”è¾ƒ ç›¸ç­‰
!== å†…å­˜åœ°å€æ¯”è¾ƒ ä¸ç›¸ç­‰
```

#### è‡ªå®šä¹‰è¿ç®—ç¬¦

```
1ã€å£°æ˜

å¤å†™ä¸€äº›å·²å£°æ˜çš„è¿ç®—ç¬¦å¯ä»¥ä¸éœ€è¦å£°æ˜ï¼Œä¾‹å¦‚ == ã€ + ã€ -

2ã€å®ç°

infixã€  prefixã€  postfix  ç”¨äºè‡ªå®šä¹‰è¡¨è¾¾å¼çš„å£°æ˜ï¼Œ åˆ†åˆ«è¡¨ç¤º ä¸­ç¼€ã€å‰ç¼€ã€åç¼€  

æ¯”å¦‚å®šä¹‰ä¸€ä¸ª  ** è¡¨è¾¾å¼  

//ä¸‹é¢è¿™é‡Œ å®ç°æ˜¯ç±»ä¼¼ ?? æ–¹æ³• ï¼Œæ‰©å±•optional    å®ç°è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•   static æ–¹æ³•

infix operator **   //è¿™å¥è¯åªèƒ½å®šä¹‰åœ¨æ–‡ä»¶ï¼Œç±»çš„å¤–é¢ï¼Œå…¶ä½™ç±»å¯ä»¥é’ˆå¯¹è¿™ä¸ªå®šä¹‰ åšä¸åŒå®ç°
func ** <T>(optional : T? , defaultValue : @autoclosure () -> T) -> T {
    if let value = optional {
        return value
    }
    return defaultValue()
}

==========================================================

å®ç°ä¸€ä¸ªæ­£åˆ™åŒ¹é…è¿ç®—ç¬¦

//MARK: - æ­£åˆ™åŒ¹é…

struct MyRegex {

    let regex: NSRegularExpression?
    init(_ pattern: String) {
        regex = try? NSRegularExpression(pattern: pattern, options: .caseInsensitive)
    }
    
    func match(input: String) -> Bool {
        if let matches = regex?.matches(in: input, options: [], range: NSRange(location: 0, length: input.length)) {
            return matches.count > 0
        }
        return false
    }
}

infix operator =~

func =~ (str: String, pattern: String) -> Bool {
    return MyRegex(pattern).match(input: str)
}

string =~ "^[0-9]$"
```



## 3ã€å­—ç¬¦ä¸²ï¼ˆå€¼ç±»å‹ï¼‰å’Œå­—ç¬¦

#### åŸºç¡€ä½¿ç”¨

```

å­—ç¬¦ä¸²ç´¢å¼•: è·å–å¯¹åº”åŒºé—´çš„å­—ç¬¦,æ ¹æ® String.Index å­—ç¬¦ä¸²ç´¢å¼•ä½¿ç”¨ä¸‹æ ‡æ–¹å¼è·å–

let greeting = "Guten Tag!"
greeting[greeting.startIndex]
// G
greeting[greeting.index(before: greeting.endIndex)]
// !
greeting[greeting.index(after: greeting.startIndex)]
// u
let index = greeting.index(greeting.startIndex, offsetBy: 7)
greeting[index]
// a

==========================================================

å…è®¸ç›´æ¥for in éå†å­—ç¬¦ä¸²: 

 for item in greeting! {
      print(item)
  }
//è¾“å‡º G u t e n T a g !

==========================================================

å­—ç¬¦ä¸²æ¯”è¾ƒç›´æ¥é€šè¿‡ == 

String å·²å®ç°Equalableåè®® é‡å†™äº† == æ–¹æ³•


```

#### å…¶ä»–ä½¿ç”¨

```
ç‰¹åˆ«æ˜¯Swift 4.0 çš„æ”¹å˜ï¼Œè®©Swift Stringæ›´åŠ äººæ€§åŒ–

==========================================================

count: å­—ç¬¦æ€»æ•°è·å–

==========================================================

å¤šè¡Œå­—ç¬¦ä¸²ä¹¦å†™ï¼šç”±ä¸€å¯¹ä¸‰ä¸ªåŒå¼•å·åŒ…è£¹ç€çš„å…·æœ‰å›ºå®šé¡ºåºçš„æ–‡æœ¬å­—ç¬¦é›†ï¼š

let data2 = """
do sth
  as you want
"""
//æ‰“å°ç»“æœä¼šæ ¹æ®å­—ç¬¦ä¸²æ ¼å¼æ‰“å°:
do sth
  as you want

==========================================================

é›†åˆç”¨æ³•
var str = "Hello, Swift 4.0"
print(str.count)            // Swift4.0å†™æ³•
/// éå†
str.forEach {
    $0
}

==========================================================


galaxy.count       // 11
galaxy.isEmpty     // false
galaxy.dropFirst() // "ilky Way ğŸ®"
String(galaxy.reversed()) // "ğŸ® yaW ykliM"


å¦‚ä½•æˆªå–å­—ç¬¦ä¸²ï¼Ÿ

substring å·²åºŸå¼ƒ

let star = str.index(str.startIndex, offsetBy: 0)

let end = str.index(str.startIndex, offsetBy: 4)

str[star..<end]

```





## 4ã€é›†åˆï¼ˆå€¼ç±»å‹ï¼‰

#### åŸºç¡€ä½¿ç”¨

```
var array = Array(repeating:0,count:5)  -> [0,0,0,0,0]

æ•°ç»„å¯ä»¥ç›´æ¥ç›¸åŠ 
var anotherThreeDoubles = Array(repeating: "2.5", count: 2)
var sixDoubles = anotherThreeDoubles + anotherThreeDoubles
// sixDoublesç±»å‹æ˜¯ [String], åŒ…å«å…ƒç´ :["2.5", "2.5", "2.5", "2.5"]
sixDoubles = sixDoubles + ["2.5"]

array = array + ["111","222","333"]
array[0...1] = ["444","555"];
print(array)
ç»“æœ: ["444", "555", "333"]

array = array + ["111","222","333"]
array[0...2] = ["444","555"]; // 0...2 size ä¸º3 ï¼Œåé¢æ•°ç»„sizeä¸º 2
print(array)
ç»“æœ: ["444", "555"]  //å¹¶ä¸ä¼šå‡ºç°ä¸¤è¾¹å› ä¸ºæ•°ç»„sizeä¸ä¸€æ ·äº§ç”Ÿé”™è¯¯ï¼Œä»¥æ›´å°sizeä¸ºå‡†

ä½†æ˜¯æ•°ç»„ä¸­åªèƒ½å­˜å‚¨åŒä¸€ç±»å‹çš„æ•°æ®

==========================================================

æ•°ç»„å¸¸ç”¨æ–¹æ³•
insert(_:at:): åœ¨æŸä¸ªä½ç½®æ’å…¥å…ƒç´   ä¸èƒ½è¶…å‡ºæ•°ç»„å¤§å°
remove(at:): ç§»é™¤æŸä¸ªä½ç½®çš„å…ƒç´ 
removeLast(): ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ 
enumerated(): è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«ç´¢å¼•å’Œå¯¹åº”ä½ç½®çš„å€¼çš„å…ƒç¥–(tuple)æ•°ç»„(Example)ã€‚

for item in array {
    print("----\(item)")
}

æˆ–è€… 

å¦‚æœéœ€è¦å…ƒç¥–çš„æ–¹å¼è·å–index åŠ  item å°±éœ€è¦ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼
for (index, item) in array.enumerated() {
    print("\(index)----\(item)")
}

// éå†æ•°ç»„
for i in 0..<array.count {
    print(array[i])
}
// forin æ–¹å¼
for item in array {
    print(item)
}
// è®¾ç½®éå†çš„åŒºé—´
for item in array[0..<2] {
    print(item)
}
// enumerated éå†
for en in array2.enumerated() {
    print(en)
    // ä¸‹æ ‡
    print(en.offset)
    // å€¼
    print(en.element)
}
// ä¸‹æ ‡å’Œæ•°å€¼åŒæ—¶éå† , å…ƒç¥–
for (n,s) in array2.enumerated() {
     print(n , "==", s);
}
// ååºéå†
for s in array2.reversed() {
    print(s)
} 
// éå†ä¸‹æ ‡å’Œæ•°å€¼ ååº
for (xxx,ooo) in array2.enumerated().reversed() {
    print(xxx ,"====" ,ooo)
}
```

## 5ã€å­—å…¸ï¼ˆå€¼ç±»å‹ï¼‰

```
å­—å…¸èµ‹å€¼

airports["LHR"] = "London"

å­—å…¸å–å€¼
let airportName = airports["DUB"]

å­—å…¸æ˜¯å¦ä¸ºç©º

airports.isEmpty

ç©ºå­—å…¸

namesOfIntegers = [:]
```

## 6ã€å±æ€§



1ã€lazy

```
//å®šä¹‰ä¸€ä¸ªé—­åŒ…
lazy var html: () -> String = {
   if let text = self.text {
        return "11111";
    } else {
        return "2222";
    }
}
//å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²
lazy var second:String = {
    if let text = self.text {
        return "11111";
    } else {
        return "2222";
    }
}()  //ä¸è¦å¿˜è®°æœ€åçš„å°æ‹¬å·ï¼Œåªæœ‰åŠ äº†å°æ‹¬å·ï¼Œæ‰è¡¨ç¤ºæ˜¯è¦è¿”å›å€¼ è€Œä¸æ˜¯è¿”å›é—­åŒ…ã€‚
	//è¦ç±»å‹å£°æ˜lazy var second:Stringï¼Œè¿™æ ·Xcodeä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ã€‚
	
	 æ‡’åŠ è½½åˆå§‹åŒ–çš„å®šä¹‰
 æ‡’åŠ è½½åˆå§‹åŒ–åªè¿›å…¥ä¸€æ¬¡  å¹¶ä¸”åœ¨éœ€è¦çš„æ—¶å€™æ‰è°ƒç”¨
 åœ¨Objective Cä¸­ï¼Œ æ‡’åŠ è½½åˆå§‹åŒ–æ˜¯è¿™æ ·å†™çš„
 @property (strong,nonatomic) CAShapeLayer * shapelayer;
  -(CAShapeLayer *)shapelayer{   
  if (!_shapelayer) {       
   		_shapelayer = [CAShapeLayer layer];    
   }    
       return _shapelayer;
    }

é‚£ä¹ˆä½•ä¸º æ‡’åŠ è½½åˆå§‹åŒ–å‘¢ï¼Ÿ 

ä»OCçš„ä»£ç ä¸­ä¸éš¾çœ‹å‡ºï¼Œ æ‡’åŠ è½½åˆå§‹åŒ–ï¼Œå°±æ˜¯åœ¨å˜é‡ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚

Swiftä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥ æ‡’åŠ è½½åˆå§‹åŒ–ã€‚ 

ç¬¬ä¸€ç§ï¼Œç®€å•è¡¨è¾¾å¼

lazy var first = NSArray(objects: "1","2")

ç¬¬äºŒç§ï¼Œé—­åŒ…

lazy var second:String = {return "second" }()

æ‡’åŠ è½½åˆå§‹åŒ–çš„ä½¿ç”¨åœºæ™¯

1ã€å±æ€§æœ¬èº«ä¾èµ–äºå¤–éƒ¨å› ç´ æ‰èƒ½åˆå§‹åŒ– 
completeURLè¡¨ç¤ºå®Œæ•´çš„URLï¼Œè¿™ä¸ªå˜é‡ä¾èµ–äºè‡ªèº«çš„urlæ˜¯å¦å«æœ‰http://å‰ç¼€
class Demo{    
var url:NSString   
lazy var completeURL:NSString = {       
   [unowned self] in       //é˜²æ­¢é—­åŒ…å¾ªç¯
   if self.url.hasPrefix("http://"){           
     return self.url        
  }else{            
     return "http://".stringByAppendingString(self.url)        
  }        
}()    

init(url:NSString){       
 self.url = url    
}}

2ã€å±æ€§éœ€è¦å¤æ‚è®¡ç®—ï¼Œæ¶ˆè€—å¤§é‡CPU

lazy var second:Int = {       
	var sum = 0        
	for i in 1...100000{ sum += i}        
	return sum        
}()

3ã€å±æ€§ä¸ç¡®å®šæ˜¯å¦ä¼šä½¿ç”¨åˆ°

å®˜ç½‘çš„ä¾‹å­ï¼Œæ³¨æ„ï¼Œå¯¹äºManageræ¥è¯´ï¼Œä½¿ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å¯¼å…¥ï¼Œä¹Ÿå¯èƒ½ä¸å€’å…¥æ•°æ®ã€‚ä»ç¡¬ç›˜è¯»å–æ•°æ®çš„ä»£ä»·æ˜¯å¾ˆå¤§çš„ï¼Œä¸å¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¸è¦åˆå§‹åŒ–ã€‚

4ã€å®šåˆ¶åŒ–çš„åˆå§‹åŒ– 

æœ‰äº›åˆå§‹åŒ–åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œåœ¨å˜é‡å®šä¹‰çš„åœ°æ–¹åˆå§‹åŒ–ï¼Œæœ‰åŠ©äºä»£ç ç»´æŠ¤

lazy var dataArray:NSMutableArray = {
  var array = NSMutableArray()        
  for  i in 1...100{
    array.addObject(NSNumber(integer: i))        
  }        
  return array        
}()
```

åœ¨ Objective-C ä¸­ï¼Œnil æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸å­˜åœ¨å¯¹è±¡çš„æŒ‡é’ˆã€‚åœ¨ Swift ä¸­ï¼Œnil ä¸æ˜¯æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œç”¨æ¥è¡¨ç¤ºå€¼çš„ç¼ºå¤±ã€‚ä¸åªæ˜¯å¯¹è±¡ç±»å‹ã€‚

Swiftå±æ€§ç›‘å¬

```
get  set  willSet didSet

var count: String {
       return ""
}
    
var _count: String = ""  //é˜²æ­¢å¾ªç¯å¼•ç”¨
var count: String {
    get {
        return _count
    }
    set {
        _count = newValue;
    }
}

var count: String = "1" {
    willSet {
        print(newValue)
    }
    didSet {
        print(oldValue)
    }
}
```



## 7ã€å¾ªç¯

```
å¾ªç¯

for num in 0...3 {
    print(interestingNumbers[num])
}

å’Œ
for num in 0..<3 {
    print(interestingNumbers[num])
}
çš„åŒºåˆ« ... æŒ‡0åˆ°3ä¹‹é—´åŒ…æ‹¬ä¸‹ç•Œ(1ï¼Œ2ï¼Œ3ï¼Œ4) , ..< ä¸åŒ…æ‹¬ä¸‹ç•Œ(0ï¼Œ1ï¼Œ2)
        

while

ä¸Šé¢çš„å°±æ²¡ä»€ä¹ˆå¥½åˆ†æ

ä¸‹é¢çš„ repeat while  ç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„ do whileï¼Œå…ˆè¿›ä¸€æ¬¡å¾ªç¯ï¼Œç„¶åæ‰§è¡Œåˆ°conditionä¸ºfalse

repeat {
    statements
} while condition

```

## 8ã€Switch

```
let someCharacter: Character = "z"
switch someCharacter {
case "a":
    print("The first letter of the alphabet")
case "z":
    print("The last letter of the alphabet")
default:
    print("Some other character")
}

æ¯ä¸€ä¸ª case åˆ†æ”¯éƒ½å¿…é¡»åŒ…å«è‡³å°‘ä¸€æ¡è¯­å¥ã€‚

ä¸ºäº†è®©å•ä¸ªcaseåŒæ—¶åŒ¹é…aå’ŒAï¼Œå¯ä»¥å°†è¿™ä¸ªä¸¤ä¸ªå€¼ç»„åˆæˆä¸€ä¸ªå¤åˆåŒ¹é…ï¼Œå¹¶ä¸”ç”¨é€—å·åˆ†å¼€ï¼š

case "a", "A":

case åˆ†æ”¯çš„æ¨¡å¼ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå€¼çš„åŒºé—´ï¼š

case 5..<12:

æ”¯æŒå…ƒç»„åŒ¹é…

case (0, 1):

å€¼ç»‘å®šï¼Œcase åˆ†æ”¯å…è®¸å°†åŒ¹é…çš„å€¼å£°æ˜ä¸ºä¸´æ—¶å¸¸é‡æˆ–å˜é‡ï¼Œå¹¶ä¸”åœ¨caseåˆ†æ”¯ä½“å†…ä½¿ç”¨:

case (let x, 0):
    print("on the x-axis with an x value of \(x)")
    
case åˆ†æ”¯çš„æ¨¡å¼å¯ä»¥ä½¿ç”¨whereè¯­å¥æ¥åˆ¤æ–­é¢å¤–çš„æ¡ä»¶ï¼š

case let (x, y) where x == y:
    print("(\(x), \(y)) is on the line x == y")
    
å¤åˆåŒ¹é…ä¹Ÿå¯ä»¥åŒ…å«å€¼ç»‘å®š

ä½¿ç”¨switch æ”¯æŒä»»æ„ç±»å‹çš„æ•°æ®ä»¥åŠå„ç§æ¯”è¾ƒæ“ä½œâ€”â€”ä¸ä»…ä»…æ˜¯æ•´æ•°ä»¥åŠæµ‹è¯•ç›¸ç­‰ã€‚
è¿è¡Œ switch ä¸­åŒ¹é…åˆ°çš„å­å¥ä¹‹åï¼Œç¨‹åºä¼šé€€å‡ºswitchè¯­å¥ï¼Œå¹¶ä¸ä¼šç»§ç»­å‘ä¸‹è¿è¡Œï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨æ¯ä¸ªå­å¥ç»“å°¾å†™breakã€‚

ä¸€å®šè¦æœ‰å¿…æ‰§è¡Œé¡¹ ï¼ˆdefaultï¼Œlet x è¿™ç§ï¼‰ä¸ç„¶ç¼–è¯‘é”™è¯¯ï¼šswitch must be exhaustiveï¼Œæšä¸¾å¦‚æœå…¨éƒ¨åˆ—ä¸¾å®Œæˆåˆ™ä¸éœ€è¦default

è´¯ç©¿ï¼Œå¦‚æœå¸Œæœ›caseæ‰§è¡Œå®Œæˆä¹‹åæ¥ä¸‹å»çš„caseä¹Ÿæ‰§è¡Œï¼Œéœ€è¦ä½¿ç”¨ fallthrough:ã€ç´§è·Ÿçš„åä¸€ä¸ªã€‘

fallthrough åé¢é¡¹ä¸èƒ½æ˜¯let x
å¦åˆ™ç¼–è¯‘é”™è¯¯
'fallthrough' from a case which doesn't bind variable 'x'


swiftå…³é”®å­—



    func asURLRequest() throws -> URLRequest {

        let result: (path: String, parameters: Parameters) = {

            switch self {

            case .paramone(let name, let age) where age > 0:

                return ("/search", ["name": name, "age": age])

            case let .paramtwo(name):

                return ("/search", ["name": name])

            }

        }()

é—®é¢˜  caseä¸­çš„whereæ¡ä»¶åˆ¤æ–­

```



## 9ã€å‡½æ•°ã€é—­åŒ…

1ã€å‡½æ•°

```
ç¬¬ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä½œä¸ºè¿”å›ç±»å‹ï¼Œå¯åµŒå¥—å‡½æ•°ï¼Œæ¯”å¦‚æŸ¯é‡ŒåŒ–æ“ä½œ



å…¶ä»–æ²¡å¤ªå¤šå¯è¯´ï¼Œæ³¨æ„ä¸€ä¸ªå¯å˜å‚æ•°

func arithmeticMean(_ numbers: Double...) -> Double {
    var total: Double = 0
    for number in numbers {
        total += number
    }
    return total / Double(numbers.count)
}
arithmeticMean(1, 2, 3, 4, 5)
// è¿”å› 3.0, æ˜¯è¿™ 5 ä¸ªæ•°çš„å¹³å‡æ•°ã€‚
arithmeticMean(3, 8.25, 18.75)
// è¿”å› 10.0, æ˜¯è¿™ 3 ä¸ªæ•°çš„å¹³å‡æ•°ã€‚


var newEvens = [Int]()
for i in 1...10 {
  if i % 2 == 0 {
         newEvens.append(i)
    } 
}
print(newEvens) // [2, 4, 6, 8, 10]

å¯ä»¥å†™æˆ

var evens = Array(1...10).filter { $0 % 2 == 0 } 
print(evens) 
// [2, 4, 6, 8, 10]
```



2ã€é—­åŒ…

```
@noescape   å˜æˆé»˜è®¤å±æ€§

@escaping é€ƒé€¸é—­åŒ…

é€ƒé€¸çš„é—­åŒ…å¸¸ç”¨äºå¼‚æ­¥çš„æ“ä½œï¼Œè¿™ç±»å‡½æ•°ä¼šåœ¨å¼‚æ­¥æ“ä½œå¼€å§‹ä¹‹åç«‹åˆ»è¿”å›ï¼Œä½†æ˜¯é—­åŒ…ç›´åˆ°å¼‚æ­¥æ“ä½œç»“æŸåæ‰ä¼šè¢«è°ƒç”¨ã€‚ä¾‹å¦‚è¿™ä¸ªé—­åŒ…æ˜¯å¼‚æ­¥å¤„ç†ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œåªæœ‰å½“è¯·æ±‚ç»“æŸåï¼Œé—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸæ‰ç»“æŸã€‚å½“é—­åŒ…ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ å…¥æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½è¿™ä¸ªé—­åŒ…åœ¨å‡½æ•°è¿”å›ä¹‹åæ‰ä¼šè¢«æ‰§è¡Œ

@autoclosure è‡ªåŠ¨é—­åŒ…

(1)é»˜è®¤éé€ƒé€¸

(2)é—­åŒ…ä¹Ÿå¯ä»¥è¢«è‡ªåŠ¨çš„ç”Ÿæˆï¼Œè¿™ç§é—­åŒ…è¢«ç§°ä¸ºè‡ªåŠ¨é—­åŒ…ï¼Œè‡ªåŠ¨é—­åŒ…è‡ªåŠ¨å°†è¡¨è¾¾å¼å°è£…æˆé—­åŒ…ã€‚

(3)è‡ªåŠ¨é—­åŒ…ä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œè¢«è°ƒç”¨æ—¶ä¼šè¿”å›è¢«åŒ…è£…åœ¨å…¶ä¸­çš„è¡¨è¾¾å¼çš„å€¼ã€‚

(4)å½“é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œå¯ä»¥å°†å‚æ•°æ ‡è®° @autoclosure æ¥æ¥æ”¶è‡ªåŠ¨é—­åŒ…ã€‚

(5)è‡ªåŠ¨é—­åŒ…èƒ½å¤Ÿå»¶è¿Ÿæ±‚å€¼,å› ä¸ºä»£ç æ®µä¸ä¼šè¢«æ‰§è¡Œç›´åˆ°ä½ è°ƒç”¨è¿™ä¸ªé—­åŒ…ã€‚

(6)è‡ªåŠ¨é—­åŒ…é»˜è®¤æ˜¯éé€ƒé€¸çš„ï¼Œå¦‚æœè¦ä½¿ç”¨é€ƒé€¸çš„é—­åŒ…ï¼Œéœ€è¦æ‰‹åŠ¨å£°æ˜: @autoclosure @escaping 

å£°æ˜å‡½æ•°æ—¶ï¼Œåœ¨å‚æ•°å‰é¢ç”¨inoutä¿®é¥°ï¼Œåœ¨å‡½æ•°å†…éƒ¨å®ç°æ”¹å˜å¤–éƒ¨å‚æ•°,æ–¹æ³•è°ƒç”¨çš„æ—¶å€™å‚æ•°éœ€è¦ &  (&åœ¨å½¢å‚ä¸­è¡¨ç¤ºâ€œå¼•ç”¨â€å®å‚)

var str = "789789"
getOne(&str)
print(str)

func getOne(_ b:inout String){
    b = "123456"
}
ç»“æœï¼š123456
```



## 10ã€æšä¸¾

```
18.swift æšä¸¾ å’Œ ocæšä¸¾

swift  æšä¸¾

https://www.jianshu.com/p/99e6ba32f244

æˆ‘ä»¬åº”è¯¥åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è€ƒè™‘ä½¿ç”¨æšä¸¾å‘¢ï¼Ÿåªè¦ç»“æœå¯èƒ½æ˜¯æœ‰é™çš„é›†åˆçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å°½é‡è€ƒè™‘ä½¿ç”¨æšä¸¾ã€‚



    swift æšä¸¾ 
        var result = Planet.One;
        result = .two;
        switch result {
          case .one:
           print("æ‰§è¡ŒOne");
          case .two:
           print("æ‰§è¡ŒTwo");
          default:
           print("æ‰§è¡ŒDefault");
        }
    
    å…ƒç¥– æšä¸¾
     enum Barcode {
        case upc(Int, Int, Int, Int)
        case qrCode(String)
    }
        
        //å…ƒç¥–çš„æ–¹å¼å¯ä»¥æŠŠæšä¸¾ä½œä¸ºä¸€ä¸ªè®¡ç®—ç±»äº†ï¼Œå¯å¸¦å‚æ•°è¿›switchçš„æ–¹ä¾¿ 
        //ä¾‹å¦‚äºŒç»´ç å’Œæ¡ç çš„å¤§ç±»ï¼Œæˆ‘ä»¬æœ‰Nä¸ªä¸åŒçš„ç ï¼Œå¯èƒ½æ˜¯äºŒç»´ç  ä¹Ÿå¯èƒ½æ˜¯æ¡ç 
        //ä½†æ˜¯æ¯ä¸ªäºŒç»´ç åˆä¸ä¸€æ ·çš„æƒ…å†µ æˆ‘ä»¬å°±éœ€è¦æŒ‰å¤§ç±»åˆ¤æ–­ã€‚
        //æ²¡æœ‰å…ƒç¥–ä¹‹å‰æˆ‘ä»¬å¤„ç†è¿™ä¸ªé—®é¢˜å°±æ˜¯å®šä¹‰ä¸¤ä¸ªç»§æ‰¿ç±» åˆ†åˆ«ä»£è¡¨äºŒç»´ç å’Œæ¡ç ï¼Œéƒ½æœ‰ä¸€ä¸ªæšä¸¾å±æ€§ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§æ¥åŒºåˆ†åˆ¤æ–­ã€‚ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ
        var productBarcode = Barcode.upc(8, 85909, 51226, 3)
        productBarcode = .qrCode("ABCDEFGHIJKLMNOP")
        
        switch productBarcode {
        case .upc(let numberSystem, let manufacturer, let product, let check):
            print("UPC: \(numberSystem), \(manufacturer), \(product), \(check).")
        case .qrCode(let productCode):
            print("QR code: \(productCode).")
    }
    // Prints "QR code: ABCDEFGHIJKLMNOP."
        

OCæšä¸¾æ–¹å¼ :

typedef NS_ENUM  æ¨èä½¿ç”¨

typedef enum

swiftæšä¸¾æ–¹å¼ :

    @objc enum FPCheckResult: NSInteger{
        case success         //æˆåŠŸ
        case sailed          //å¤±è´¥
        case passcodeNotSet //æœªè®¾ç½®æ‰‹æœºå¯†ç 
        case touchidNotSet  //æœªè®¾ç½®æŒ‡çº¹
        case touchidNotAvailable //ä¸æ”¯æŒæŒ‡çº¹
    }å¤§é©¼å³°å‘½ååç§° å°é©¼å³°å‘½åæˆå‘˜
    
    swift å®šä¹‰çš„æšä¸¾åœ¨OCä¸­ä½¿ç”¨ ä¼šè‡ªåŠ¨æŠŠæšä¸¾åå­—æ·»åŠ åˆ°å‰é¢åšå‰ç¼€  æ¯”å¦‚FP_SUCCESS é€‚é…åœ¨OCä¸­æ˜¯ FPCheckResultSuccess
    
    ä¸åƒ C å’Œ Objective-C ä¸€æ ·ï¼ŒSwift çš„æšä¸¾æˆå‘˜åœ¨è¢«åˆ›å»ºæ—¶ä¸ä¼šè¢«èµ‹äºˆä¸€ä¸ªé»˜è®¤çš„æ•´æ•°å€¼ã€‚åœ¨ä¸Šé¢çš„FPCheckResultä¾‹å­ä¸­ï¼ŒSuccessï¼ŒFailedï¼ŒPasscodeNotSetå’ŒTouchidNotSetä¸æ˜¯éšå¼å¾—ç­‰äº0ï¼Œ1ï¼Œ2å’Œ3ã€‚ç›¸åçš„ï¼Œè¿™äº›ä¸åŒçš„æšä¸¾æˆå‘˜åœ¨FPCheckResultçš„ä¸€ç§æ˜¾ç¤ºå®šä¹‰ä¸­æ‹¥æœ‰å„è‡ªä¸åŒçš„å€¼ã€‚
    
    oc å®šä¹‰çš„æšä¸¾  å¤§é©¼å³°å‘½åè§„åˆ™
    æ³¨æ„ï¼šOCä¸­å®šä¹‰çš„æšä¸¾åœ¨OCä¸­å¯ä»¥ä¸éœ€è¦é€šè¿‡æšä¸¾åå­—è·å–ï¼Œä½†åœ¨swiftä¸­éœ€è¦ç”¨æšä¸¾.æ–¹æ³•è·å–ï¼Œæ‰€ä»¥æŠŠæšä¸¾åå­—å†™åœ¨æšä¸¾å˜é‡å‰é¢åšå‰ç¼€ï¼Œ swiftè§£æçš„æ—¶å€™ä¼šè‡ªåŠ¨å»æ‰å‰ç¼€ã€‚æ—¢æ–¹ä¾¿ocåˆæ–¹ä¾¿swiftã€‚
    typedef NS_ENUM(NSInteger, FundType) {
        FundTypeMonetary   = 1,//å…¬å‹Ÿè´§å¸åŸºé‡‘
        FundTypeBond       = 2,//å…¬å‹Ÿå€ºåŸºåŸºé‡‘
    };
    
    å¤šä¸ªæˆå‘˜å€¼å¯ä»¥å‡ºç°åœ¨åŒä¸€è¡Œä¸Šï¼Œç”¨é€—å·éš”å¼€ï¼š
    enum Planet { 
        case mercury, venus, earth, mars, jupiter, saturn, uranus, nepturn 
    } 
    
    var directionToHead = CompassPoint.west 
    
    ä¸€æ—¦ä¸€ä¸ªç†Ÿæ‚‰ è¢«å®šä¹‰æˆä¸€ä¸ªæšä¸¾åï¼Œå¦‚ä¸Šï¼Œæˆ–è€…switch æŒ‡å®šç­‰ã€‚ å°±å¯ä»¥ç›´æ¥ç”¨ç‚¹æ–¹æ³•ç»™å±æ€§è®¾ç½®å…¶ä»–æšä¸¾æˆå‘˜ã€‚
    
    
    
    ä¸‹é¢çš„æšä¸¾æ˜¯å¯¹ä¹‹å‰Planetè¿™ä¸ªæšä¸¾çš„ä¸€ä¸ªç»†åŒ–ï¼Œåˆ©ç”¨åŸå§‹æ•´å‹å€¼æ¥è¡¨ç¤ºæ¯ä¸ª planet åœ¨å¤ªé˜³ç³»ä¸­çš„é¡ºåºï¼š
    enum Planet: Int {
        case mercury = 1, venus, earth, mars, jupiter, saturn, uranus, neptune
    }
    è‡ªåŠ¨é€’å¢æ„å‘³ç€Planet.venusçš„åŸå§‹å€¼æ˜¯2ï¼Œä¾æ¬¡ç±»æ¨ã€‚
     
    ä½¿ç”¨æšä¸¾æˆå‘˜çš„rawValueå±æ€§å¯ä»¥è®¿é—®è¯¥æšä¸¾æˆå‘˜çš„åŸå§‹å€¼ï¼š
    let earthsOrder = Planet.earth.rawValue 
    // earthsOrder is 3 
    
    é€šè¿‡rawValueå»è·å–å¯¹åº”æšä¸¾æˆå‘˜
    let possiblePlanet =Planet(rawValue: 7)
    // possiblePlanet is of type Planet? and equals Planet.Uranus 
    
    
    å¦‚æœæ²¡æœ‰æŒ‡å®šæšä¸¾ç±»å‹ æ˜¯æ— æ³•è·å–rowValueçš„ 

å¦‚æœéœ€è¦åœ¨ocä¸­ä½¿ç”¨swiftå®šä¹‰çš„æšä¸¾ éœ€è¦åŠ ä¸Š @objcå‰ç¼€  å¦‚æœæ˜¯swiftå®šä¹‰çš„åè®® ä¹Ÿæ˜¯ä¸€æ ·çš„



å–„äºä½¿ç”¨æšä¸¾ã€ç»“æ„ä½“ç­‰

    enum ExampleProvider {
        static func systemStyle() -> UITabBarController {
            let tabBarController = UITabBarController()
            return tabBarController
        }
    }




```



## 11ã€ç±»å’Œç»“æ„ä½“

```
32.ç»“æ„ä½“

    ä½¿ç”¨æ–¹æ³•å’Œç±»å·®ä¸å¤š
    
    struct NameSpaceTwo {
        var length: Int
        var height: Int
        
        func countTwo() -> Int {
            return height + length
        }
    }
    
    å’Œç±»çš„åŒºåˆ«
     struct æ˜¯ Value Type è€Œ class æ˜¯ Reference Type ï¼Œ Value Typeæ˜¯å€¼ç±»å‹ï¼Œreference type æ˜¯å¼•ç”¨ç±»å‹
     
    åœ¨æ¯æ¬¡åš assignment çš„æ™‚å€™ï¼Œvalue type éƒ½ä¼šå¤åˆ¶ä¸€ä»½å®Œæ•´ç›¸åŒçš„å…§å®¹çµ¦å¦ä¸€å€‹å˜é‡ï¼Œè€Œ class å‰‡æ˜¯æŠŠå†…å®¹å¯¹åº”çš„å†…å­˜åœ°å€çµ¦å˜é‡ã€‚
    
    let spacetwo = NameSpaceTwo(protocolParam: "8888", length: 5, height: 5)
    let spacethree = spacetwo
    
    print(Unmanaged<AnyObject>.passUnretained(spacethree as AnyObject).toOpaque())
    print(Unmanaged<AnyObject>.passUnretained(spacetwo as AnyObject).toOpaque())
    
    let çš„æ–¹å¼çš„ struct å†…éƒ¨å‚æ•°ä¸èƒ½æ”¹å˜
    
    spacethree å’Œ spacetwo çš„æ”¹å˜éƒ½ä¸ä¼šå¯¹å¯¹æ–¹äº§ç”Ÿå½±å“ã€‚
    
    
    
    mutating å…³é”®å­—
    ä½¿ç”¨ mutating å…³é”®å­—ä¿®é¥°æ–¹æ³•æ˜¯ä¸ºäº†èƒ½åœ¨è¯¥æ–¹æ³•ä¸­ä¿®æ”¹ struct æˆ–æ˜¯ enum çš„å˜é‡ï¼Œåœ¨è®¾è®¡æ¥å£çš„æ—¶å€™ï¼Œä¹Ÿè¦è€ƒè™‘åˆ°ä½¿ç”¨è€…ç¨‹åºçš„æ‰©å±•æ€§ã€‚æ‰€ä»¥è¦å¤šè€ƒè™‘ä½¿ç”¨mutatingæ¥ä¿®é¥°æ–¹æ³•ã€‚
    
    struct test {
        var name: String = "111"
        mutating func changeName() -> String {
            name = "2222"
            return name
        }
    }




```



## 12ã€åè®®

```
åè®®ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä¾ç„¶æ˜¯ä¸èƒ½æœ‰æ–¹æ³•ä½“ï¼Œåè®®å¯ä»¥è®¾ç½®å‚æ•°ï¼Œå‚æ•°å¿…é¡»è¦è®¾ç½®{get} æˆ–è€… {get set}

ä½¿ç”¨ extension ä¸ºç°æœ‰çš„ç±»å‹æ·»åŠ åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªè®¡ç®—å±æ€§çš„æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ extension æ¥ç»™ä»»æ„ç±»å‹æ·»åŠ åè®®ï¼Œç”šè‡³æ˜¯ä»å¤–éƒ¨åº“æˆ–è€…æ¡†æ¶ä¸­å¯¼å…¥çš„ç±»å‹ã€‚

ä½ å¯ä»¥åƒä½¿ç”¨å…¶ä»–å‘½åç±»å‹ä¸€æ ·ï¼Œåˆ›å»ºä¸€ä¸ªæœ‰ä¸åŒç±»å‹ä½†æ˜¯éƒ½å®ç°åŒä¸€ä¸ªåè®®çš„å¯¹è±¡é›†åˆã€‚å½“ä½ å¤„ç†åè®®ç±»å‹çš„å€¼æ—¶ï¼Œåè®®å¤–å®šä¹‰çš„æ–¹æ³•ä¸å¯ç”¨ã€‚éƒ½è¢«å½“æˆåè®®ç±»å‹å¯¹è±¡å¤„ç†

swift åè®®

å±æ€§è¦æ±‚
åè®®èƒ½å¤Ÿè¦æ±‚å…¶éµå¾ªè€…å¿…é¡»å«æœ‰ä¸€äº›ç‰¹å®šåç§°å’Œç±»å‹çš„å®ä¾‹å±æ€§(instance property)æˆ–ç±»å±æ€§ (type property)ï¼Œä¹Ÿèƒ½å¤Ÿè¦æ±‚å±æ€§çš„(è®¾ç½®æƒé™)settable å’Œ(è®¿é—®æƒé™)gettableï¼Œä½†å®ƒä¸è¦æ±‚å±æ€§æ˜¯å­˜å‚¨å‹å±æ€§(stored property)è¿˜æ˜¯è®¡ç®—å‹å±æ€§(calculate property)ã€‚
 
é€šå¸¸å‰ç½®varå…³é”®å­—å°†å±æ€§å£°æ˜ä¸ºå˜é‡ã€‚åœ¨å±æ€§å£°æ˜åå†™ä¸Š{ get set }è¡¨ç¤ºå±æ€§ä¸ºå¯è¯»å†™çš„ã€‚{ get }ç”¨æ¥è¡¨ç¤ºå±æ€§ä¸ºå¯è¯»çš„ã€‚å³ä½¿ä½ ä¸ºå¯è¯»çš„å±æ€§å®ç°äº†setteræ–¹æ³•ï¼Œå®ƒä¹Ÿä¸ä¼šå‡ºé”™ã€‚

protocol SomeProtocol { 
    var musBeSettable : Int { get set } 
    var doesNotNeedToBeSettable: Int { get } 
} 


protocol myProtocol {
    var count: Int {get}
}

struct myStruct: myProtocol {
    var count: Int 
}
åœºæ™¯1.
var s: myProtocol = myStruct(count: 5)
s.count = 4 //ä¼šç¼–è¯‘å‡ºé”™ï¼ŒåŸå› å°±æ˜¯read-only

åœºæ™¯2.
var s = myStruct(count: 5)
s.count = 4 //æ­£å¸¸ç¼–è¯‘

å¯é€‰åè®®

import Foundation

@objc protocol myProtocol {
    @objc optional func some()
}
class myStruct: myProtocol {
    var count: Int

    init() {
        self.count = 5
    }
    func some() {
        print("dfadsf")
    }
}
var s: myProtocol = myStruct()
s.some?()


55.åè®®æ‰©å±•çš„ä½œç”¨

    swiftåè®®æ‰©å±•å¯ä»¥æä¾›æ›´å¤šçš„æ–¹æ³•çš„å®ç°,ä¸èƒ½ä¸å®ç°
    åè®®æ‰©å±•çš„çº¦æŸ
    æ¯”å¦‚æˆ‘å®šä¹‰ä¸€ä¸ªåè®®æ‰©å±•ï¼Œä½†æ˜¯æˆ‘éœ€è¦å®ç°è€…æ»¡è¶³æŸä¸ªæ¡ä»¶(å®ç°äº†å¦ä¸€ä¸ªåè®®)
    è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨whereæ¥é™åˆ¶
    
    extension Collection where Iterator.Element: TextRepresentable {
        var textualDescription: String {
            let itemsAsText = self.map { $0.textualDescription }
            return "[" + itemsAsText.joined(separator: ", ") + "]"
        }
    }



```



## 13ã€æ³›å‹

```
extension Array {
//Element è¿™ä¸ªåœ°æ–¹ä½¿ç”¨Elementçš„åŸå› æ˜¯arrayä¸­é»˜è®¤å…ƒç´ ç±»å‹æ˜¯Element
    public func my_map<T>(_ element: (Element) -> T) -> [T] {
        var array_new = Array<T>()
        for item in self {
            let item_new = element(item)
           array_new.append(item_new)
        }
        return array_new
    }
}

é™åˆ¶æ³›å‹ç±»å‹ï¼Œä¾‹å¦‚æ‰€æœ‰çš„æ³›å‹å‚æ•°éƒ½è¦å®ç° NameSpaceProtocol åè®®ï¼Œå¦‚ä¸‹ä¸¤ç§å†™æ³•
func getTwo<T>(_ E : T) where T : NameSpaceProtocol{
}
func getTwo<T : NameSpaceProtocol>(_ E : T){
}
```



## 14ã€å…¶ä»–

#### æ‰“å°å†…å­˜åœ°å€

```
print(Unmanaged<AnyObject>.passUnretained(spacetwo as AnyObject).toOpaque())
```

#### æ³¨é‡Š

```
// MARK: - æ“ä½œ
// TODO: - è®°å¾—åš
// FIXME: - æé†’
```



#### Swift ä¸­çš„å¼•ç”¨å¾ªç¯

**ARC**

ARC è‹¹æœç‰ˆæœ¬çš„è‡ªåŠ¨å†…å­˜ç®¡ç†çš„ç¼–è¯‘æ—¶é—´ç‰¹æ€§ã€‚å®ƒä»£è¡¨äº†è‡ªåŠ¨å¼•ç”¨è®¡æ•°(Automatic Reference Counting)ã€‚ä¹Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œåªæœ‰åœ¨å¼•ç”¨è®¡æ•°ä¸º0çš„æƒ…å†µä¸‹å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚

**Strongï¼ˆå¼ºå¼•ç”¨ï¼‰**

è®©æˆ‘ä»¬ä»ä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨è¯´èµ·ã€‚å®ƒå®è´¨ä¸Šå°±æ˜¯æ™®é€šçš„å¼•ç”¨(æŒ‡é’ˆç­‰ç­‰)ï¼Œä½†æ˜¯å®ƒçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒèƒ½å¤Ÿé€šè¿‡ä½¿å¯¹è±¡çš„å¼•ç”¨è®¡æ•°+1æ¥ä¿æŠ¤å¯¹è±¡ï¼Œé¿å…å¼•ç”¨å¯¹è±¡è¢«ARCæœºåˆ¶é”€æ¯ã€‚æœ¬è´¨ä¸Šæ¥è®²ï¼Œä»»ä½•å¯¹è±¡åªè¦æœ‰å¼ºå¼•ç”¨ï¼Œå®ƒå°±ä¸ä¼šè¢«é”€æ¯æ‰ã€‚è®°ä½è¿™ç‚¹å¯¹æˆ‘æ¥ä¸‹æ¥è¦è®²çš„å¼•ç”¨å¾ªç¯ç­‰å…¶ä»–çŸ¥è¯†æ¥è¯´å¾ˆé‡è¦ã€‚

å¼ºå¼•ç”¨åœ¨Swiftä¸­æ— å¤„ä¸åœ¨ã€‚äº‹å®ä¸Šï¼Œå½“ä½ å£°æ˜ä¸€ä¸ªå±æ€§æ—¶ï¼Œå®ƒå°±é»˜è®¤æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“å¯¹è±¡ä¹‹é—´çš„å…³ç³»ä¸ºçº¿æ€§æ—¶ï¼Œä½¿ç”¨å¼ºå¼•ç”¨æ˜¯å®‰å…¨çš„ã€‚å½“å¯¹è±¡ä¹‹é—´çš„å¼ºå¼•ç”¨æ˜¯ä»çˆ¶å±‚çº§æµå‘å­å±‚çº§æ—¶ï¼Œç”¨å¼ºå¼•ç”¨é€šå¸¸ä¹Ÿæ˜¯okçš„ã€‚

**weakï¼ˆå¼±å¼•ç”¨ï¼‰**

weak å¼•ç”¨å¹¶ä¸èƒ½ä¿æŠ¤æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«ARCæœºåˆ¶é”€æ¯ã€‚å¼ºå¼•ç”¨èƒ½ä½¿è¢«å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨è®¡æ•°+1ï¼Œè€Œå¼±å¼•ç”¨ä¸ä¼šã€‚æ­¤å¤–ï¼Œè‹¥å¼±å¼•ç”¨çš„å¯¹è±¡è¢«é”€æ¯åï¼Œå¼±å¼•ç”¨çš„æŒ‡é’ˆä¼šè¢«æ¸…ç©ºã€‚è¿™æ ·ä¿è¯äº†å½“ä½ è°ƒç”¨ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡æ—¶ï¼Œä½ èƒ½å¾—åˆ°ä¸€ä¸ªå¯¹è±¡æˆ–è€…nil. 

åœ¨swiftä¸­ï¼Œæ‰€æœ‰çš„å¼±å¼•ç”¨éƒ½æ˜¯éå¸¸é‡çš„å¯é€‰ç±»å‹(å¯¹æ¯” var å’Œ let) ï¼Œå› ä¸ºå½“æ²¡æœ‰å¼ºå¼•ç”¨å¯¹è±¡å¼•ç”¨çš„çš„æ—¶å€™,å¼±å¼•ç”¨å¯¹è±¡èƒ½å¤Ÿå¹¶ä¸”ä¼šå˜æˆnilã€‚ 

ä¾‹å¦‚ï¼Œè¿™æ ·çš„ä»£ç ä¸ä¼šé€šè¿‡ç¼–è¯‘ 

```
class Kraken {  
     weak let tentacle = Tentacle() 
     //let is a constant! All weak variables MUST be mutable.  
}  
```

å› ä¸ºtentacleæ˜¯ä¸€ä¸ªletå¸¸é‡ã€‚Letå¸¸é‡åœ¨è¿è¡Œçš„æ—¶å€™ä¸èƒ½è¢«æ”¹å˜ã€‚å› ä¸ºå¼±å¼•ç”¨å˜é‡åœ¨æ²¡æœ‰è¢«å¼ºå¼•ç”¨çš„æ¡ä»¶ä¸‹ä¼šå˜æˆnilï¼Œæ‰€ä»¥Swift ç¼–è¯‘å™¨è¦æ±‚ä½ å¿…é¡»ç”¨varæ¥å®šä¹‰å¼±å¼•ç”¨å¯¹è±¡ã€‚ 

å€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œä½¿ç”¨å¼±å¼•ç”¨å˜é‡èƒ½å¤Ÿé¿å…ä½ å‡ºç°å¯èƒ½çš„å¼•ç”¨å¾ªç¯ã€‚å½“ä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼ºå¼•ç”¨çš„æ—¶å€™ä¼šå‡ºç°ä¸€ä¸ªå¼•ç”¨å¾ªç¯ã€‚å¦‚æœ2ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨å¯¹æ–¹ï¼ŒARCå°±ä¸èƒ½ç»™è¿™ä¸¤ä¸ªå¯¹è±¡å‘å‡ºåˆé€‚çš„é‡Šæ”¾ä¿¡æ¯ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡å½¼æ­¤ç›¸äº’ä¾å­˜ã€‚ä¸‹å›¾æ˜¯ä»è‹¹æœå®˜æ–¹ç®€æ´çš„å›¾ç‰‡ï¼Œå®ƒå¾ˆå¥½çš„è§£é‡Šäº†è¿™ç§æƒ…å†µ: 

![](https://xilankong.github.io/resource/strong.png)

ä¸€ä¸ªæ¯”è¾ƒæ°å½“çš„ä¾‹å­å°±æ˜¯é€šçŸ¥APIsï¼Œçœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç : 

```
class Kraken {  
 var notificationObserver: ((NSNotification) -> Void)?  
     init() {  
         notificationObserver = NSNotificationCenter.defaultCenter().addObserverForName("humanEnteredKrakensLair", object: nil, queue: NSOperationQueue.mainQueue()) { notification in  
             self.eatHuman()  
         }  
     }  
       
     deinit {  
         if notificationObserver != nil {  
             NSNotificationCenter.defaultCenter.removeObserver(notificationObserver)  
         }  
     }  
 }

```

  

åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æœ‰ä¸€ä¸ªå¼•ç”¨å¾ªç¯ã€‚å¦‚æœåœ¨é—­åŒ…èŒƒå›´ä¹‹å¤–å£°æ˜å˜é‡ï¼Œé‚£ä¹ˆåœ¨é—­åŒ…ä¸­ä½¿ç”¨è¿™ä¸ªå˜é‡æ—¶ï¼Œä¼šå¯¹è¯¥å˜é‡äº§ç”Ÿå¦ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯ä½¿ç”¨å€¼ç±»å‹çš„å˜é‡ï¼Œæ¯”å¦‚Swiftä¸­çš„ Intsã€Stringsã€Arraysä»¥åŠDictionariesç­‰ã€‚

åœ¨è¿™é‡Œï¼Œå½“ä½ è°ƒç”¨eatHuman( ) æ—¶ï¼ŒNSNotificationCenterå°±ä¿ç•™äº†ä¸€ä¸ªé—­åŒ…ä»¥å¼ºå¼•ç”¨æ–¹å¼æ•è·selfã€‚ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼Œä½ åº”è¯¥åœ¨deinitæ–¹æ³•ä¸­æ¸…é™¤é€šçŸ¥ç›‘å¬å¯¹è±¡ã€‚è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºæˆ‘ä»¬æ²¡æœ‰æ¸…é™¤æ‰blockç›´åˆ°deinit.ä½†æ˜¯deinit æ°¸è¿œéƒ½ä¸ä¼šè¢«ARCæœºåˆ¶è°ƒç”¨ï¼Œå› ä¸ºé—­åŒ…å¯¹Krakenå®ä¾‹æœ‰å¼ºå¼•ç”¨ã€‚ 

å¦å¤–åœ¨NSTimerså’ŒNSThreadä¹Ÿå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚ 

è§£å†³è¿™ç§æƒ…å†µçš„æ–¹æ³•å°±æ˜¯:**åœ¨é—­åŒ…çš„æ•è·åˆ—è¡¨ä¸­ä½¿ç”¨å¯¹selfçš„å¼±å¼•ç”¨**ã€‚è¿™æ ·å°±èƒ½å¤Ÿæ‰“ç ´å¼ºå¼•ç”¨å¾ªç¯ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„å¯¹è±¡å¼•ç”¨å›¾å°±ä¼šåƒè¿™æ ·ï¼š 

![](https://xilankong.github.io/resource/strong.png)

æŠŠselfå˜æˆweakä¸ä¼šè®©self çš„å¼•ç”¨è®¡æ•°+1ï¼Œå› æ­¤ARCæœºåˆ¶å°±èƒ½åœ¨åˆé€‚çš„æ—¶é—´é‡Šæ”¾æ‰å¯¹è±¡ã€‚ 

æƒ³è¦åœ¨é—­åŒ…ä½¿ç”¨ weak å’Œ unowned å˜é‡ï¼Œä½ åº”è¯¥ç”¨[]æŠŠå®ƒä»¬æ‹¬èµ·æ¥ã€‚å¦‚ï¼š

```
 let closure = { [weak self] in   
     self?.doSomething() //Remember, all weak variables are Optionals!  
 }  
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¸ºä»€ä¹ˆè¦æŠŠ weak self è¦æ”¾åœ¨æ–¹æ‹¬å·å†…ï¼Ÿçœ‹ä¸Šå»ç®€ç›´ç§€é€—äº†ï¼åœ¨Swiftä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æ–¹æ‹¬å·å°±ä¼šæƒ³åˆ°æ•°ç»„ã€‚ä½ çŒœæ€ä¹ˆç€ï¼Ÿä½ å¯ä»¥åœ¨åœ¨é—­åŒ…å†…å®šä¹‰å¤šä¸ªæ•è·å€¼ï¼ä¾‹å¦‚ï¼š 

```
let closure = { [weak self, unowned krakenInstance] in //Look at that sweet Array of capture values.  
     self?.doSomething() //weak variables are Optionals!  
     krakenInstance.eatMoreHumans() //unowned variables are not.  
}  
```



è¿™æ ·çœ‹ä¸Šå»æ›´åƒæ˜¯æ•°ç»„äº†ï¼Œå¯¹å§ï¼Ÿç°åœ¨ä½ çŸ¥é“ä¸ºä»€ä¹ˆæŠŠæ•è·å€¼æ”¾åœ¨æ–¹æ‹¬å·é‡Œé¢äº†å§ã€‚é‚£ä¹ˆç”¨æˆ‘ä»¬å·²äº†è§£çš„ä¸œè¥¿ï¼Œé€šè¿‡åœ¨é—­åŒ…æ•è·åˆ—è¡¨ä¸­åŠ ä¸Š[weak self]ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§£å†³ä¹‹å‰é‚£æ®µæœ‰å¼•ç”¨å¾ªç¯çš„é€šçŸ¥ä»£ç ã€‚ 

```
NSNotificationCenter.defaultCenter().addObserverForName("humanEnteredKrakensLair", object: nil, queue: NSOperationQueue.mainQueue()) { [weak self] notification in //The retain cycle is fixed by using capture lists!  
    self?.eatHuman() //self is now an optional!  
}  
```

å…¶ä»–æˆ‘ä»¬ç”¨åˆ°weakå’Œunownedå˜é‡çš„æƒ…å†µæ˜¯å½“ä½ ä½¿ç”¨åè®®åœ¨å¤šä¸ªç±»ä¹‹é—´å®ç°ä»£ç†æ—¶ï¼Œå› ä¸ºSwiftä¸­ç±»ä½¿ç”¨çš„æ˜¯reference semanticsã€‚åœ¨Swiftä¸­ï¼Œç»“æ„ä½“å’Œæšä¸¾åŒæ ·èƒ½å¤Ÿéµå¾ªåè®®ï¼Œä½†æ˜¯å®ƒä»¬ç”¨çš„æ˜¯value semanticsã€‚å¦‚æœåƒè¿™æ ·ä¸€ä¸ªçˆ¶ç±»å¸¦ä¸Šä¸€ä¸ªå­ç±»ä½¿ç”¨å§”æ‰˜ä½¿ç”¨äº†ä»£ç†: 

```
1. class Kraken: LossOfLimbDelegate {  
2.     let tentacle = Tentacle()  
3.     init() {  
4.         tentacle.delegate = self  
5.     }  
6.       
7.     func limbHasBeenLost() {  
8.         startCrying()  
9.     }  
10. }  
11. 
12. protocol LossOfLimbDelegate {  
13.     func limbHasBeenLost()  
14. }  
15. 
16. class Tentacle {  
17.     var delegate: LossOfLimbDelegate?  
18.       
19.     func cutOffTentacle() {  
20.         delegate?.limbHasBeenLost()  
21.     }  
22. }  
```

åœ¨è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç”¨weakå˜é‡äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒTentacleä»¥ä»£ç†å±æ€§çš„å½¢å¼å¯¹Krakenæœ‰ç€ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œè€ŒKrakenåœ¨å®ƒçš„Tentacleå±æ€§ä¸­å¯¹Tentacleä¹Ÿæœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚æˆ‘ä»¬é€šè¿‡åœ¨ä»£ç†å£°æ˜å‰é¢åŠ ä¸Šweakæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š 

```
weak var delegate: LossOfLimbDelegate?  
```

æ˜¯ä¸æ˜¯å‘ç°è¿™æ ·å†™ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Ÿä¸èƒ½é€šè¿‡ç¼–è¯‘çš„åŸå› æ˜¯é classç±»å‹çš„åè®®ä¸èƒ½è¢«æ ‡è¯†æˆweakã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¿…é¡»è®©åè®®ç»§æ‰¿:classï¼Œä»è€Œä½¿ç”¨ä¸€ä¸ªç±»åè®®å°†ä»£ç†å±æ€§æ ‡è®°ä¸ºweakã€‚ 

```
1. protocol LossOfLimbDelegate: class { //The protocol now inherits class  
2.     func limbHasBeenLost()  
3. }  
```

å½“ä½ æœ‰ç€è·Ÿæˆ‘ä¸Šè¿°ä»£ç ä¸€æ ·çš„å¼•ç”¨å…³ç³»ï¼Œä½ å°±ç”¨:classã€‚åœ¨ç»“æ„ä½“å’Œæšä¸¾çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¿…è¦ç”¨:classï¼Œå› ä¸ºç»“æ„ä½“å’Œæšä¸¾æ˜¯value semanticsï¼Œè€Œç±»æ˜¯ reference semantics.  

**UNOWNED(å¼±å¼•ç”¨) **

weakå¼•ç”¨å’Œunownedå¼•ç”¨æœ‰äº›ç±»ä¼¼ä½†ä¸å®Œå…¨ç›¸åŒã€‚Unowned å¼•ç”¨ï¼Œåƒweakå¼•ç”¨ä¸€æ ·ï¼Œä¸ä¼šå¢åŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚ç„¶è€Œï¼Œåœ¨Swifté‡Œï¼Œä¸€ä¸ªunownedå¼•ç”¨æœ‰ç€éå¯é€‰ç±»å‹çš„ä¼˜ç‚¹ã€‚è¿™æ ·ç›¸æ¯”äºå€ŸåŠ©å’Œä½¿ç”¨optional bindingæ›´æ˜“äºç®¡ç†ã€‚è¿™å’Œéšå¼å¯é€‰ç±»å‹åŒºåˆ«ä¸å¤§ã€‚æ­¤å¤–ï¼Œunownedå¼•ç”¨æ˜¯non-zeroing(éé›¶çš„) ,è¿™è¡¨ç¤ºç€å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå®ƒæŒ‡å¼•çš„å¯¹è±¡ä¸ä¼šæ¸…é›¶ã€‚ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨unownedå¼•ç”¨åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´é‡æŒ‡é’ˆã€‚

çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è›‹ç–¼äº†ã€‚æ—¢ç„¶Weakå’Œunownedå¼•ç”¨éƒ½ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå®ƒä»¬éƒ½èƒ½ç”¨äºè§£é™¤å¼•ç”¨å¾ªç¯ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥åœ¨ä»€ä¹ˆä½¿ç”¨å®ƒä»¬å‘¢ï¼Ÿ

```
åœ¨å¼•ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå¦‚æœå®ƒå¯èƒ½ä¸ºnilï¼Œé‚£ä¹ˆå°±ç”¨weakå¼•ç”¨ã€‚åä¹‹ï¼Œå½“ä½ çŸ¥é“å¼•ç”¨å¯¹è±¡åœ¨åˆå§‹åŒ–åæ°¸è¿œéƒ½ä¸ä¼šä¸ºnilå°±ç”¨unowned. 
```

ç°åœ¨ä½ å°±çŸ¥é“äº†ï¼šå°±åƒæ˜¯éšå¼å¯é€‰ç±»å‹ï¼Œå¦‚æœä½ èƒ½ä¿è¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¼•ç”¨å¯¹è±¡ä¸ä¼šä¸ºnilï¼Œç”¨unowned ã€‚å¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆå°±ç”¨weak 

ä¸‹é¢å°±æ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚Class é‡Œé¢çš„é—­åŒ…æ•è·äº†selfï¼Œselfæ°¸è¿œä¸ä¼šä¸ºnilã€‚ 

```
1. class RetainCycle {  
2.     var closure: (() -> Void)!  
3.     var string = "Hello"  
4.     init() {  
5.         closure = {  
6.             self.string = "Hello, World!"  
7.         }  
8.     }  
9. }  

æ”¹æˆ

1. closure = { [unowned self] in  
2.     self.string = "Hello, World!"  
3. }  
```

å¦‚æœä½ çŸ¥é“ä½ å¼•ç”¨çš„å¯¹è±¡ä¼šåœ¨æ­£ç¡®çš„æ—¶æœºé‡Šæ”¾æ‰ï¼Œä¸”å®ƒä»¬æ˜¯ç›¸äº’ä¾å­˜çš„ï¼Œè€Œä½ ä¸æƒ³å†™ä¸€äº›å¤šä½™çš„ä»£ç æ¥æ¸…ç©ºä½ çš„å¼•ç”¨æŒ‡é’ˆï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥ä½¿ç”¨unownedå¼•ç”¨è€Œä¸æ˜¯weakå¼•ç”¨ã€‚

åƒä¸‹é¢è¿™ç§æ‡’åŠ è½½åœ¨é—­åŒ…ä¸­ä½¿ç”¨selfå°±æ˜¯ä¸€ä¸ªä½¿ç”¨unownedçš„å¾ˆå¥½ä¾‹å­ï¼š 

```
1. class Kraken {  
2.     let petName = "Krakey-poo"  
3.     lazy var businessCardName: () -> String = { [unowned self] in  
4.         return "Mr. Kraken AKA " + self.petName  
5.     }  
6. }  
```

æˆ‘ä»¬éœ€è¦ç”¨unowned self æ¥é¿å…å¼•ç”¨å¾ªç¯ã€‚Kraken å’Œ businessCardNameåœ¨å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½ç›¸äº’æŒæœ‰å¯¹æ–¹ã€‚å®ƒä»¬ç›¸äº’æŒæœ‰ï¼Œå› æ­¤æ€»æ˜¯è¢«åŒæ—¶é”€æ¯ï¼Œæ»¡è¶³ä½¿ç”¨unowned çš„æ¡ä»¶ã€‚ 

ç„¶è€Œï¼Œä¸è¦æŠŠä¸‹é¢çš„æ‡’åŠ è½½å˜é‡ä¸é—­åŒ…æ··æ·†ï¼š 

```
1. class Kraken {  
2.     let petName = "Krakey-poo"  
3.     lazy var businessCardName: String = {  
4.         return "Mr. Kraken AKA " + self.petName  
5.     }()  
6. }  
```

åœ¨æ‡’åŠ è½½å˜é‡ä¸­è°ƒç”¨closureæ—¶ï¼Œç”±äºæ²¡æœ‰retain closureï¼Œæ‰€ä»¥ä¸éœ€è¦åŠ  unowned selfã€‚å˜é‡åªæ˜¯ç®€å•çš„æŠŠé—­åŒ…çš„ç»“æœassign ç»™äº†è‡ªå·±ï¼Œé—­åŒ…åœ¨ä½¿ç”¨åå°±è¢«ç«‹å³é”€æ¯äº†ã€‚ä¸‹é¢çš„æˆªå›¾å¾ˆå¥½çš„è¯æ˜äº†è¿™ç‚¹ã€‚

![ä¸‹è½½.jpg](http://cc.cocimg.com/api/uploads/20160129/1454053485567250.jpg)





## 15ã€ Swift å’Œ OCçš„ Hybird ç¼–ç¨‹

#### æ··ç¼–å¸¦æ¥çš„æ–‡ä»¶å˜åŒ–

```
swift å’Œ OC æ··ç”¨ä¼šæœ‰ä¸¤ä¸ªæ–°æ–‡ä»¶ 

1ã€å·¥ç¨‹å-Swift.h æ˜¯ ç”¨äº OC è°ƒç”¨ swift ã€æ˜¯swiftä»£ç åœ¨å·¥ç¨‹ä¸­è‡ªåŠ¨æ›´æ–°å‡ºçš„ OC æ ¼å¼ä»£ç 
 ä¸å¯è§ï¼Œä½†æ˜¯å¯ä»¥è·³è½¬è¿›å…¥ï¼Œæ‰€æœ‰swiftä»£ç ç”Ÿæˆçš„ç±»å±æ€§ éƒ½ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­è½¬ä¹‰ä¸€ä»½ OC çš„æ ·å¼ï¼Œå¦‚æœåœ¨podä¸­çš„èµ„æºæ— æ³•å¼•ç”¨ï¼Œæ£€æŸ¥æ˜¯å¦æœªæ·»åŠ @objc æˆ–è€…æ˜¯å¦ public 

2ã€å·¥ç¨‹å-Bridging-Header.h æ˜¯ç”¨äº swift è°ƒç”¨ oc çš„å¤´æ–‡ä»¶ï¼Œæ‰€æœ‰éœ€è¦å¼•å…¥swiftçš„OCéƒ½éœ€è¦å…ˆåœ¨è¿™ä¸ªæ–‡ä»¶å¼•å…¥ã€‚


swiftå·¥ç¨‹å¼•ç”¨OC podåº“  ä¸éœ€è¦é€šè¿‡æ¡¥æ–‡ä»¶ ç›´æ¥importå¯¹åº”çš„åº“åç§°ï¼Œä¹Ÿå°½é‡å°‘åœ¨bridgeæ–‡ä»¶ä¸­å¯¹OCåº“çš„å¤´æ–‡ä»¶è¿›è¡Œå¼•ç”¨ï¼Œå½±å“Xcodeç¼–è¯‘æ•ˆç‡

podå¼•ç”¨æ³¨æ„ï¼š

Swiftå†™çš„ pod ä¸­é‡åˆ°çš„é”™è¯¯ï¼šimport äº†å¯¹åº”çš„ moduleåè¿˜æ˜¯æç¤ºæœªå®šä¹‰
Swiftå†™çš„åº“éœ€è¦æš´éœ²çš„éƒ¨åˆ†éœ€è¦ä½¿ç”¨public or openä¿®é¥°ï¼Œæ‰€æœ‰éœ€è¦æš´éœ²å‡ºå»çš„å†…å®¹éƒ½éœ€è¦ä¿®é¥°ï¼Œå¦åˆ™é»˜è®¤ä¸å¼€æ”¾ï¼Œå¤–éƒ¨æ˜¯æ— æ³•ä½¿ç”¨çš„
    
public åªèƒ½è¢«æœ¬moduleå†…å®¹ ç»§æ‰¿é‡å†™
open  å¯ä»¥è¢«å…¶ä»–moduleå†…å®¹ ç»§æ‰¿é‡å†™
```

#### Swiftå‘½åç©ºé—´

```
Swiftçš„ç±»å è½¬æˆ oc è‡ªå¸¦äº†æ ¼å¼ï¼Œå¹¶éç›´æ¥åå­—ã€‚æ‰€ä»¥é€šè¿‡classå»å¯»æ‰¾æŒ‡å®šç±»éœ€è¦è½¬className

åœ¨swiftæ ¹æ®ç±»åæ‰¾xibä¹Ÿéœ€è¦æ³¨æ„å‘½åç©ºé—´ï¼Œä¸€èˆ¬å¼å·¥ç¨‹å.ç±»å

//è·å–xib
  class func nib() -> UINib {
      let className = NSStringFromClass(self)
      let postfix = className.components(separatedBy: ".").last
      return UINib(nibName: postfix!, bundle: nil)
  }

//è·å–å¯¹åº”className
- (Class)swiftClassFromString:(NSString *)className {

  	NSString *appName = 
  	[[NSBundle mainBundle] objectForInfoDictionaryKey:@"CFBundleName"];
	NSString *classStringName = 
	[NSString stringWithFormat:@"_TtC%d%@%d%@", appName.length, appName, className.length, className];
  	return NSClassFromString(classStringName);

}

podèµ„æºä¸­çš„swiftç±»åç§° ä¼šæ˜¯ å·¥ç¨‹åç§°.podåç§°.ç±»åç§°

oc é€šè¿‡xibåˆå§‹åŒ–swiftæ§åˆ¶å™¨çš„æ—¶å€™ï¼Œ ä¸èƒ½ç›´æ¥ç”¨className å»æŸ¥æ‰¾å¯¹åº”nib  å› ä¸ºswiftå­˜åœ¨åŸŸå å‰é¢æœ‰å·¥ç¨‹åçš„å‰ç¼€

swift viewController xibåˆå§‹åŒ–çš„æ—¶å€™è¦å®ç°å¯¹åº”çš„æŒ‡å®šæ„é€ å™¨ initï¼ˆï¼‰å¹¶åœ¨æ„é€ å™¨é‡Œé¢super.initï¼ˆæ ¹æ®xibåå­—å»åˆå§‹åŒ–ï¼‰


```

#### Swiftçš„åˆå§‹åŒ–

**1ã€Swiftåˆå§‹åŒ–è§„åˆ™**

```
1ã€å®ç°çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨
2ã€å¦‚æœå®ç°äº†è‡ªå·±çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼ŒæŒ‡å®šåˆå§‹åŒ–å™¨éœ€è¦è°ƒç”¨çˆ¶ç±»æŒ‡å®šåˆå§‹åŒ–å™¨ï¼ŒåŒæ—¶ä¼šç»§æ‰¿çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨

-----------------å…³äºåˆå§‹åŒ–çš„ç»§æ‰¿---------------------
è§„åˆ™ 1
å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰ä»»ä½•æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œå®ƒå°†è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ã€‚

è§„åˆ™ 2
å¦‚æœå­ç±»æä¾›äº†æ‰€æœ‰çˆ¶ç±»æŒ‡å®šåˆå§‹åŒ–å™¨çš„å®ç°--ä¸ç®¡æ˜¯é€šè¿‡è§„åˆ™1ç»§æ‰¿è¿‡æ¥çš„ï¼Œè¿˜æ˜¯é€šè¿‡è‡ªå®šä¹‰å®ç°çš„--å®ƒå°†è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çˆ¶ç±»çš„ä¾¿æ·åˆå§‹åŒ–å™¨ã€‚å› ä¸ºä¾¿æ·åˆå§‹åŒ–å™¨éƒ½æ˜¯åŸºäºæŒ‡å®šåˆå§‹åŒ–å™¨çš„


åˆå§‹åŒ–æ–¹æ³•çš„é—®é¢˜
ç‰¹åˆ«æ˜¯swiftç»§æ‰¿ocç±»çš„æƒ…å†µ

1.swiftç»§æ‰¿è‡ªswift çš„æƒ…å†µä¸‹ çˆ¶ç±»çš„åˆå§‹åŒ–å™¨ï¼Œè‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨
2.å¦‚æœå®ç°äº†æ‰€æœ‰çš„çˆ¶ç±»æŒ‡å®šåˆå§‹åŒ–å™¨ å°†è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çš„ä¾¿åˆ©åˆå§‹åŒ–å™¨

1.å½“å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„æ—¶å€™ï¼Œå¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–ä»»ä½•çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¸èƒ½å»ºç«‹ä¾¿åˆ©åˆå§‹åŒ–å™¨ï¼Œå¹¶ä¸”è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ã€‚
2.å¦‚æœå­ç±»è‡ªå·±å»ºç«‹äº†æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œå¹¶ä¸”æœªè¦†ç›–çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œé‚£ä¹ˆå®ƒå°†å¤±å»æ‰€æœ‰çš„çˆ¶ç±»åˆå§‹åŒ–å™¨çš„ä½¿ç”¨ã€‚
```

**2ã€æŒ‡å®šåˆå§‹åŒ–å™¨ã€ä¾¿æ·åˆå§‹åŒ–å™¨**

```

Swiftç»§æ‰¿è‡ªocçš„æ—¶å€™ä¼šå‡ºç°ä¸€ç§æƒ…å†µ å°±æ˜¯ è¦æ±‚å®ç°æŒ‡å®šåˆå§‹åŒ–å™¨

å½“AswiftControllerç»§æ‰¿ä¸€ä¸ªBOCcontrollerçš„æ—¶å€™ï¼ŒBocControllerä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
UIViewControlleré»˜è®¤çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ˜¯
- (instancetype)initWithNibName:(nullable NSString *)nibNameOrNil bundle:(nullable NSBundle *)nibBundleOrNil NS_DESIGNATED_INITIALIZER;

æˆ–è€…æˆ‘ä»¬è‡ªå·±æŒ‡å®šä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨OCä¸­å†™ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶ç”¨ NS_DESIGNATED_INITIALIZER æ ‡ç¤ºæ ‡å‡ºï¼Œé‚£ä¹ˆåœ¨swiftä¸­å¾—åˆå§‹åŒ–æ–¹æ³•å°±å¿…é¡»å®ç°è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•

OCæ§åˆ¶å™¨ A
swiftæ§åˆ¶å™¨  B ç»§æ‰¿è‡ª A
OCæ§åˆ¶å™¨ C
swiftæ§åˆ¶å™¨ B ç»§æ‰¿è‡ªOCæ§åˆ¶å™¨ A ï¼Œç„¶ååˆå†å¦ä¸€ä¸ªOC  C è°ƒç”¨ B æ§åˆ¶å™¨ ï¼Œocè°ƒç”¨ ç›´æ¥alloc init é‚£ä¹ˆå°±ä¼šè°ƒç”¨åˆ° B æ§åˆ¶å™¨ä¸­ çš„éæŒ‡å®šåˆå§‹åŒ–å™¨ initæ–¹æ³•ï¼Œåœ¨ç‰¹å®šç³»ç»Ÿï¼ˆ8.å‡ ï¼‰è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨swift ç»§æ‰¿è‡ªOCçš„æ—¶å€™å°±å¤å†™æŒ‡å®šåˆå§‹åŒ–å™¨æ–¹æ³•ï¼Œå¹¶å®ç°initæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»æŒ‡å®šåˆå§‹åŒ–å™¨ã€‚

Swift å®ç°çš„æ§åˆ¶å™¨ éœ€è¦å®ç°initæ–¹æ³•
init() {
    super.init(nibName: nil, bundle: nil)
}
required init?(coder aDecoder: NSCoder) {
    fatalError("init(coder:) has not been implemented")
}
æˆ–è€…åœ¨B çš„çˆ¶ç±» A ä¸­å®ç°initæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­é€šè¿‡æŒ‡å®šåˆå§‹åŒ–å™¨å®ç°åˆå§‹åŒ–(initWithNIB)
Bï¼š
init() {
    super.init()
}
required init?(coder aDecoder: NSCoder) {
    fatalError("init(coder:) has not been implemented")
}
Aï¼š
- (instancetype)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
    if (self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil]) {
    }
    return self;
}
- (instancetype)init{
    return [self initWithNibName:nil bundle:nil];
}


æŒ‡å®šåˆå§‹åŒ–å™¨çºµå‘å®ç°ï¼ˆå§”æ‰˜çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼‰ï¼Œä¾¿æ·åˆå§‹åŒ–å™¨æ¨ªå‘å®ç°(è°ƒç”¨æœ¬èº«çš„æŒ‡å®šåˆå§‹åŒ–å™¨)

å¦‚æœä¾¿æ·åˆå§‹åŒ–å™¨æ¥æ”¶å‚æ•°å’Œçˆ¶ç±»æŒ‡å®šåˆå§‹åŒ–å™¨ä¸€æ ·ï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Šoverride

```

**3ã€å¿…è¦åˆå§‹åŒ–å™¨**

```
å½“æˆ‘ä»¬é‡å†™ç±»çš„æ—¶å€™ç»å¸¸æç¤ºè¦æ·»åŠ ä»£ç ï¼š

required init?(coder aDecoder: NSCoder) {
    fatalError("init(coder:) has not been implemented")
}
è¿™ä¸ªå«å¿…è¦åˆå§‹åŒ–å™¨ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬ä¼šå‡ºç°åœ¨ç»§æ‰¿äº†éµå®ˆNSCoding protocolçš„ç±»ï¼Œæ¯”å¦‚UIViewç³»åˆ—çš„ç±»ã€UIViewControllerç³»åˆ—çš„ç±»ã€‚

ä¸ºä»€ä¹ˆä¸€å®šè¦æ·»åŠ ï¼š
è¿™æ˜¯NSCoding protocolå®šä¹‰çš„ï¼Œéµå®ˆäº†NSCoding protoaolçš„æ‰€æœ‰ç±»å¿…é¡»ç»§æ‰¿ã€‚åªæ˜¯æœ‰çš„æƒ…å†µä¼šéšå¼ç»§æ‰¿ï¼Œè€Œæœ‰çš„æƒ…å†µä¸‹éœ€è¦æ˜¾ç¤ºå®ç°ã€‚

ä»€ä¹ˆæƒ…å†µä¸‹è¦æ˜¾ç¤ºæ·»åŠ ï¼š
å½“æˆ‘ä»¬åœ¨å­ç±»å®šä¹‰äº†æŒ‡å®šåˆå§‹åŒ–å™¨(åŒ…æ‹¬è‡ªå®šä¹‰å’Œé‡å†™çˆ¶ç±»æŒ‡å®šåˆå§‹åŒ–å™¨)ï¼Œé‚£ä¹ˆå¿…é¡»æ˜¾ç¤ºå®ç°required init?(coder aDecoder: NSCoder)ï¼Œè€Œå…¶ä»–æƒ…å†µä¸‹åˆ™ä¼šéšå¼ç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç†ä¼šã€‚

ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè°ƒç”¨ï¼š
å½“æˆ‘ä»¬ä½¿ç”¨storyboardå®ç°ç•Œé¢çš„æ—¶å€™ï¼Œç¨‹åºä¼šè°ƒç”¨è¿™ä¸ªåˆå§‹åŒ–å™¨ã€‚
æ³¨æ„è¦å»æ‰fatalErrorï¼ŒfatalErrorçš„æ„æ€æ˜¯æ— æ¡ä»¶åœæ­¢æ‰§è¡Œå¹¶æ‰“å°ã€‚

æ€»ç»“ï¼š
å¦‚æœä»£ç å®ç°ç•Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦æ ¹æ®ç¼–è¯‘å™¨æç¤ºæ·»åŠ å¿…è¦åˆå§‹åŒ–å™¨åï¼Œå°±ä¸ç”¨ç†ä¼šï¼Œæˆ‘ä»¬åˆ›å»ºç•Œé¢çš„å·¥ä½œå¯ä»¥åœ¨è‡ªå®šä¹‰çš„åˆå§‹åŒ–å™¨é‡Œå®ç°ã€‚

è¡¥å……ï¼šlet vc = UIViewController()æ–¹å¼åˆå§‹åŒ–ç±»
UIViewControllerç±»è§†ä¹åªæœ‰ä¸¤ä¸ªåˆå§‹åŒ–å™¨ï¼Œä¸€ä¸ªæ˜¯å¿…è¦åˆå§‹åŒ–å™¨init?(coder aDecoder: NSCoder)ï¼Œä¸€ä¸ªæ˜¯æŒ‡å®šåˆå§‹åŒ–å™¨init(nibName nibNameOrNil: String?, bundle nibBundleOrNil: NSBundle?)ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨let vc = UIViewController()è¿™ç§æ–¹å¼åˆå§‹åŒ–ç±»å‘¢ï¼ŸåŸå› å¯èƒ½æ˜¯è¿™ä¸ªåˆå§‹åŒ–æ–¹å¼æ˜¯æ¥è‡ªuikit,ä¹Ÿå°±æ˜¯è°ƒç”¨äº†Object-cä¸‹çš„UIViewControlleråˆå§‹åŒ–æ–¹æ³•ï¼Œæ˜¯object-c bridgeè¿‡æ¥çš„ã€‚
```

**4ã€åˆå§‹åŒ–è¿‡ç¨‹**

```

Swift çš„åˆå§‹åŒ–åˆ†ä¸¤é˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µæ˜¯ç±»çš„åˆ†é…å†…å­˜åœ°å€ å¹¶ä¸”ç»™ç±»çš„å±æ€§åˆ†é…å†…å­˜åœ°å€
ä½äºsuper.init ä¹‹å‰ã€‚å¦‚æœæ²¡æœ‰çˆ¶ç±»ï¼Œå°±åº”è¯¥æ˜¯æ‰€æœ‰çš„å±æ€§éƒ½æœ‰å€¼ä¹‹åç®—ç¬¬äºŒé˜¶æ®µã€‚

ç¬¬ä¸€é˜¶æ®µ

1ã€æŒ‡å®šæˆ–ä¾¿æ·åˆå§‹åŒ–å™¨åœ¨ç±»ä¸­è¢«è°ƒç”¨
2ã€ä¸ºè¿™ä¸ªç±»çš„æ–°å®ä¾‹åˆ†é…å†…å­˜ã€‚å†…å­˜è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–
3ã€è¿™ä¸ªç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ç¡®ä¿æ‰€æœ‰ç”±æ­¤ç±»å¼•å…¥çš„å­˜å‚¨å±æ€§éƒ½æœ‰ä¸€ä¸ªå€¼ã€‚ç°åœ¨è¿™äº›å­˜å‚¨å±æ€§çš„å†…å­˜è¢«åˆå§‹åŒ–äº†
4ã€æŒ‡å®šåˆå§‹åŒ–å™¨ä¸Šäº¤çˆ¶ç±»çš„åˆå§‹åŒ–å™¨ä¸ºå…¶å­˜å‚¨å±æ€§æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡
5ã€è¿™ä¸ªè°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–å™¨çš„è¿‡ç¨‹å°†æ²¿ç€åˆå§‹åŒ–å™¨é“¾ä¸€ç›´å‘ä¸Šè¿›è¡Œï¼Œç›´åˆ°åˆ°è¾¾åˆå§‹åŒ–å™¨é“¾çš„æœ€é¡¶éƒ¨
6ã€ä¸€æ—¦è¾¾äº†åˆå§‹åŒ–å™¨é“¾çš„æœ€é¡¶éƒ¨ï¼Œåœ¨é“¾é¡¶éƒ¨çš„ç±»ç¡®ä¿æ‰€æœ‰çš„å­˜å‚¨å±æ€§éƒ½æœ‰ä¸€ä¸ªå€¼ï¼Œæ­¤å®ä¾‹çš„å†…å­˜è¢«è®¤ä¸ºå®Œå…¨åˆå§‹åŒ–äº†ï¼Œæ­¤æ—¶ç¬¬ä¸€é˜¶æ®µå®Œæˆã€‚


ç¬¬äºŒé˜¶æ®µå°±æ˜¯super.init ä¹‹åï¼Œselfå·²ç»å…·ä½“å®ç°å®Œæˆï¼Œå¯ä»¥è°ƒç”¨æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œå®šåˆ¶ï¼Œsuper.init æ˜¯ä¸ºäº†å®Œæˆåˆ°çˆ¶ç±»å®ç°initçš„å§”æ‰˜ã€‚è¿™ä¸ªæ˜¯å…·ä½“çš„å®ç°ã€‚

å®‰å…¨æ£€æŸ¥
1ã€æŒ‡å®šåˆå§‹åŒ–å™¨å¿…é¡»ä¿è¯åœ¨å‘ä¸Šå§”æ‰˜ç»™çˆ¶ç±»åˆå§‹åŒ–å™¨ä¹‹å‰ï¼Œå…¶æ‰€åœ¨ç±»å¼•å…¥çš„æ‰€æœ‰å±æ€§éƒ½è¦åˆå§‹åŒ–å®Œæˆã€‚
2ã€æŒ‡å®šåˆå§‹åŒ–å™¨å¿…é¡»å…ˆå‘ä¸Šå§”æ‰˜çˆ¶ç±»åˆå§‹åŒ–å™¨ï¼Œç„¶åæ‰èƒ½ä¸ºç»§æ‰¿çš„å±æ€§è®¾ç½®æ–°å€¼ã€‚å¦‚æœä¸è¿™æ ·åšï¼ŒæŒ‡å®šåˆå§‹åŒ–å™¨èµ‹äºˆçš„æ–°å€¼å°†è¢«çˆ¶ç±»ä¸­çš„åˆå§‹åŒ–å™¨æ‰€è¦†ç›–ã€‚
3ã€ä¾¿æ·åˆå§‹åŒ–å™¨å¿…é¡»å…ˆå§”æ‰˜åŒç±»ä¸­çš„å…¶å®ƒåˆå§‹åŒ–å™¨ï¼Œç„¶åå†ä¸ºä»»æ„å±æ€§èµ‹æ–°å€¼ï¼ˆåŒ…æ‹¬åŒç±»é‡Œå®šä¹‰çš„å±æ€§ï¼‰
4ã€åˆå§‹åŒ–å™¨åœ¨ç¬¬ä¸€é˜¶æ®µåˆå§‹åŒ–å®Œæˆä¹‹å‰ï¼Œä¸èƒ½è°ƒç”¨ä»»ä½•å®ä¾‹æ–¹æ³•ã€ä¸èƒ½è¯»å–ä»»ä½•å®ä¾‹å±æ€§çš„å€¼ï¼Œä¹Ÿä¸èƒ½å¼•ç”¨ self ä½œä¸ºå€¼ã€‚
è¿èƒŒæ£€æŸ¥è§„åˆ™çš„éƒ½æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚

æ‹“å±•ï¼š

åœ¨OCä¸­çš„ initæ–¹æ³•å†…
- (instancetype)init
{
    NSLog(@"%@",self); //è¿™ä¸ªæ—¶å€™selfå·²ç»è¢«åˆ†é…åœ°å€ï¼Œä»–å¾—å±æ€§ä¸èƒ½é€šè¿‡ç‚¹ç¬¦å·ç‚¹å‡ºï¼Œå¯ä»¥æŒ‡å‘ï¼Œè¯´æ˜åœ°å€ä¹Ÿæ˜¯è¢«åˆ†é…äº†ã€‚
    self = [super init];//å…·ä½“å®ç° åé¢æ‰å¯ä»¥è°ƒç”¨æ–¹æ³•
    if (self) {
    }
    return self;
}

å¯ç©ºåˆå§‹åŒ–å™¨

struct Animal {
    let species: String
    init?(species: String) {
        if species.isEmpty { return nil }
        self.species = species
    }
}
```





## 16ã€Swiftåå°„

æ‰€è°“åå°„å°±æ˜¯å¯ä»¥åŠ¨æ€è·å–ç±»å‹ã€æˆå‘˜ä¿¡æ¯ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥è°ƒç”¨æ–¹æ³•ã€å±æ€§ç­‰è¡Œä¸ºçš„ç‰¹æ€§ã€‚ åœ¨ä½¿ç”¨`OC`å¼€å‘æ—¶å¾ˆå°‘å¼ºè°ƒå…¶åå°„æ¦‚å¿µï¼Œå› ä¸ºOCçš„`Runtime`è¦æ¯”å…¶ä»–è¯­è¨€ä¸­çš„åå°„å¼ºå¤§çš„å¤šã€‚ä¸è¿‡åœ¨`Swift`ä¸­å¹¶ä¸æå€¡ä½¿ç”¨`Runtime`ï¼Œè€Œæ˜¯åƒå…¶ä»–è¯­è¨€ä¸€æ ·ä½¿ç”¨åå°„(`Reflect`)ï¼Œå³ä½¿ç›®å‰`Swift`ä¸­çš„åå°„åŠŸèƒ½è¿˜æ¯”è¾ƒå¼±ï¼Œåªèƒ½è®¿é—®è·å–ç±»å‹ã€æˆå‘˜ä¿¡æ¯ã€‚

`Swift`çš„åå°„æœºåˆ¶æ˜¯åŸºäºä¸€ä¸ªå«`Mirror`çš„ç»“æ„ä½“æ¥å®ç°çš„ã€‚ä½ ä¸ºå…·ä½“çš„å®ä¾‹åˆ›å»ºä¸€ä¸ª`Mirror`å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å®ƒæŸ¥è¯¢è¿™ä¸ªå®ä¾‹

```
ä½¿ç”¨æ¡ˆä¾‹
func propertyList() -> [String] {
      //è·å–â€˜ç±»â€™çš„å±æ€§åˆ—è¡¨
      let mirror = Mirror(reflecting: self)
      if mirror.children.count == 0 {
          return []
      }
      var arr = [String]()

      for item in mirror.children {
          let name = item.label!
          arr.append(name)
      }

      return arr
  }
```



##### Mirrorç»“æ„ä½“å¸¸ç”¨å±æ€§ï¼š

- `subjectType`ï¼šå¯¹è±¡ç±»å‹
- `children`ï¼šåå°„å¯¹è±¡çš„å±æ€§é›†åˆ
- `displayStyle`ï¼šåå°„å¯¹è±¡å±•ç¤ºç±»å‹

##### ä¸‹é¢æ¥ç®€å•ä»‹ç»ä¸‹Mirrorçš„ä½¿ç”¨ï¼š

```
//å®šä¹‰ä¸€ä¸ªç±»æ¥è¿›è¡Œæµ‹è¯•
class Person {
    var name: String?
    var age: Int = 0
}
//åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶åˆå§‹åŒ–
let p = Person()
p.name = "å°å¼º"
p.age = 13

//1. åˆ›å»ºå¯¹è±¡çš„åå°„ï¼Œè·å–å¯¹è±¡ç±»å‹
let mirror: Mirror = Mirror(reflecting:p)
print("è·å–å¯¹è±¡ç±»å‹\(mirror.subjectType)") 
// æ‰“å°å‡ºï¼šè·å–å¯¹è±¡ç±»å‹Person

//2. è·å–å¯¹è±¡å±æ€§åä»¥åŠå¯¹åº”çš„å€¼
for p in mirror.children {
    let propertyNameString = p.label! //å±æ€§åä½¿ç”¨!ï¼Œå› ä¸ºlabelæ˜¯optionalç±»å‹ 
    let value = p.value //å±æ€§çš„å€¼
    print("\(propertyNameString)çš„å€¼ä¸º\(value)")
}
/* æ‰“å°:
nameçš„å€¼ä¸ºOptional("å°å¼º")
ageçš„å€¼ä¸º13
 */

//3. è·å–æŒ‡å®šç´¢å¼•ä¸‹çš„å±æ€§ç±»å‹
let children = mirror.children
let p0 = children.startIndex.advancedBy(0) //è·å–nameå±æ€§çš„ä½ç½®ç´¢å¼•
let p0Mirror =  Mirror(reflecting: children[p0].value) //nameçš„åå°„
print("è·å–å±æ€§nameçš„ç±»å‹ä¸º\(p0Mirror.subjectType)") 
//æ‰“å°ï¼šè·å–å±æ€§nameçš„ç±»å‹ä¸ºOptional

//4. éå†è·å–å¯¹è±¡æ‰€æœ‰åŠ¨æ€çš„å±æ€§ç±»å‹
for p in mirror.children {
    let propertyNameString = p.label!
    let value = p.value
    let vMirror = Mirror(reflecting: value) //é€šè¿‡å€¼æ¥åˆ›å»ºå±æ€§çš„åå°„
    print("å±æ€§\(propertyNameString)ç±»å‹ä¸º\(vMirror.subjectType)")
}
/* æ‰“å°ï¼š
å±æ€§nameç±»å‹ä¸ºOptional
å±æ€§ageç±»å‹ä¸ºInt
 */
```